<!DOCTYPE html>
<html lang="ko_KR" itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="UTF-8">
    
    <title>CONNEXUS RECALL</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://weblog.youre.space/styles.css">
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="https://weblog.youre.space/styles_ie.css">
    <script src="https://connexus.youre.space/mt-static/support/theme_static/rainier/js/html5shiv.js"></script>
    <![endif]-->
    
    <link rel="start" href="https://weblog.youre.space/">
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="https://weblog.youre.space/atom.xml" />
    <link rel="manifest" href="/webmanifest.json">
    <link rel="canonical" href="https://weblog.youre.space/" />
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-102177098-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <!-- Open Graph Protocol -->
    <meta property="og:type" content="article">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:title" content="CONNEXUS RECALL">
    <meta property="og:url" content="https://weblog.youre.space/">
    
    <meta property="og:site_name" content="CONNEXUS RECALL">
    <meta property="og:image" content="https://weblog.youre.space/assets_c/2017/11/weblog-youre-space_512x512-thumb-320x320-12.png">
    <!-- Microdata -->
    
    <meta itemprop="name" content="CONNEXUS RECALL">
    <link itemprop="url" href="https://weblog.youre.space/">
    <link itemprop="image" href="https://weblog.youre.space/assets_c/2017/11/weblog-youre-space_512x512-thumb-320x320-12.png">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "url": "http://weblog.youre.space",
  "logo": "http://weblog.youre.space/assets_c/2017/11/weblog-youre-space_512x512-thumb-320x320-12.png"
}
</script>
  
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TCRBH6V');</script>
<!-- End Google Tag Manager -->
  </head>
  <body>
    <div id="container">
      <div id="container-inner">
        <header id="header" role="banner">
          <div id="header-inner">
            <div id="header-content">
              <h1>
                <a href="https://weblog.youre.space/">

                  CONNEXUS RECALL

                </a>
              </h1>
              
            </div>

            <nav role="navigation">
          <ul>
            <li><a href="https://weblog.youre.space/">Home</a></li>


          </ul>
        </nav>

          </div>
        </header>
        <div id="content">
          <div id="content-inner">
            <div id="index-main" class="main" role="main">

              <article id="entry-3914" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003914.html">코로나19 고양시-40,41 확진자 세부 동선(2020.5.11(월) 11:00) - 40번 확진자 동선 추가</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:29+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  
        <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="https://weblog.youre.space/imyaman/ii-2/">수정</a></li>
  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      &lt;코로나19 고양시-40,41 확진자 세부동선 알림&gt;2020년 5월 11일(월) 11:00✔[동선 추가] 고양시-40 확진자 세부동선 - 20대, 남성, 화정역 부근 H오피스텔, 용인시 66번 확진자 접촉자* 5월 2일(토) 1:30~6:00 이태원클럽(킹,퀸,소호) 방문* 5월 3일(일) 16:30~22:30 타지역 이동(전철 이동)23:52 화정 OO편의점(도보 이동)* 5월 4일(월) 19:00 타지역 이동(화정역에서 종로3가역 전철 이동)* 5월 5일(화) 증상 발현(발열, 몸살, 인후통, 설사)23:00 타지역 동선( 종로 용산 전철 이동 후 자택 귀가)* 5월 6일(수) 13:08-14:24 화정OO PC방(도보 이동) 14:58-15:06 화정OO생필품점(도보 이동)20:34-22:40 화정OOPC방(도보 이동) *5월 7일.......
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMMG4R-2F5VOeab9rWn5PCp24Qk-2B9GrOW-2BOyiAoEk2PfUQXrtidMc6-2FlJDoAOXc2YR0lQ7kf5SFQl413tVRfm2ij-2BqtpebH0EIDCcWpK-2BFZvhbuO66ofy6CdW4av5n7upVjbVOtMq4PIhCRVO4PKDKOqXpq5Atfz4SJhVooyfPFljk-2FHo-2B9HQy3yGver4ikF1q3h53YDHX6KPRL9MJcDyCer0paqHAGfCMoO1xLQCSGQKPww-3D-3D" alt="" width="1" height="1" />

  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003914.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3913" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003913.html">코로나19 고양시 현황</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:28+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  
        <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="https://weblog.youre.space/imyaman/5i-11ii/">5월 11일(월)</a></li>
  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      &lt;코로나19 고양시 현황&gt;2020년 5월 11일(월)확진환자: 41명 (11명 입원, 29명 퇴원, 1명 사망)접촉관리 대상자: 736명· 자가격리 대상자: 736명 (23명 감소)· 능동감시 대상자: 0명 (변동없음)- 경기도재난기본소득 신청: 1인 세대 중 신청자 생년 끝번 1,6만 가능 - 고양시 위기극복지원금 신청: 신청자 생년끝번, 세대원수 관계 없이 지급- 정부 긴급재난지원금: 5월 11일(월)부터 오전 7시부터 생년끝번 1,6 세대주 카드사 홈페이지 신청 - https://www.긴급재난지원금.kr/ (조회는 5부제 해제로, 바로 조회 가능합니다.)- 응원메시지 보내기https://blog.naver.com/letsgoyang/221856102088코로나19 감염이 의심된다면의료기관 방.......
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMM-2FZxq8uAh9fJGiXYfZKbAQRJhV9Zw20YthOz37ZyDzLMn9cLtNnE3YwpSTx8V3eqH4bCcSY-2BrWENVzIZYN15DANQ99t6nu7W-2Bu45qp0nbRWalBeG4lvvKKPMMvH-2BE46QAVyKjAUGzkdDXE7DLsjY7taulsH8lcyAHANFTExehPyPKRCiqnQUineDqklJIz4b43B82ooWKjEYTe41VECBRMiFdpCyrnCU-2BAxHwHZ60zOA-3D-3D" alt="" width="1" height="1" />

  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003913.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3912" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003912.html">코로나19 극복 캠페인과 미술이 만났을 때 - 지하철에서 8월까지 기다릴게요!</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:26+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  
        <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="https://weblog.youre.space/imyaman/ieii-3/">성남여행</a></li>
  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      그럼에도 불구하고 완연한 봄입니다.사회적 거리두기가 생활방역체제로 옮겨가며미뤄뒀던 우리의 일상도 다시 제자리를 찾아가고 있습니다.아직 속단할 순 없지만 코로나19 혼란의 끝자락에서코로나19 극복 지정 캠페인과 미술의 만남이성남 주요 지하철역을 순회하고 있어 그 소식 전해드립니다.성남문화재단, 코레일이 주최・주관하고성남시가 후원하는 &lt;성남 문화예술인 지하철 전시회&gt;는5월 1일부터 8월 20일까지 성남 주요 지하철역을 순회합니다.(출처: 성남문화재단)5월 1일부터 14일까지 전시가 진행되는이매역과 오리역에 직접 나가보았습니다.이매역은 성남아트센터가 위치한 역이기도 합니다........
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMM5c-2FA2pL2H8H8DyD-2BU6JE-2BGPhCKjgF7dRxBQ9pQ0Zao-2B955wcOlRRioMmIWQFgmDbV9AoejE-2BLyHYsHZl2e5hbJGtpWt-2BXG7CpEPLxZfc3N-2FXSCUfq5ZqDDTIDOGZbpLG1kBC9ZKe5aUPNSn1H07WRGyO7X9D1ev5gxw0C86-2FLMQkCtEpCu3l-2BUKClFgSo2POtrQTECfi0osQIW68ZJr08SUlbGKcENyksG5tbVWkrYQ-3D-3D" alt="" width="1" height="1" />

  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003912.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3911" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003911.html">지역감염 확산방지를 위한 이태원 클럽 집단감염 관련 긴급행정명령</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:25+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  
        <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="https://weblog.youre.space/imyaman/ieii-1/">성남정책</a></li>
  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
        <div>
          <div>[성남정책] 지역감염 확산방지를 위한 이태원 클럽 집단감염 관련 긴급행정명령</div>
            <div>
              authors: [""]
            </div>
            <div>
              categories: ["시민생각 성남정책"]
            </div>
            <div>
              content: 
            </div>
            <div>
              date_published: 2020-05-11T19:59:39+09:00
            </div>
            <div>
              description: 
            </div>
            <div>
              enclosure: 
            </div>
            <div>
              id: http://seongnamdiary.com/221957398739
            </div>
            <div>
              image: 
            </div>
            <div>
              last_updated: 2020-05-11T19:59:39+09:00
            </div>
            <div>
              links: [{"href"=&gt;"http://seongnamdiary.com/221957398739"}]
            </div>
            <div>
              url: http://seongnamdiary.com/221957398739
            </div>
            <div>
              urls: ["http://seongnamdiary.com/221957398739"]
            </div>
        </div>
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMNBQwxnuJEROMqbxx4s1cyk7X9g2C8X7x2-2B5ZpIZfNDJAH9Nk6Ip6PhFGjauomWlf09bX3Hft-2BEVCVvBoygVkpdoCeODywq7BRN7qYKJ69-2FfXGL1QSDA6Cgcnyf-2BgYdJ30wPn3XBK-2BEJ78rM3ix4-2BPYA2-2BIH5DQ4yEGgznclsLriYcc6ph-2FPq7KiYW7kFmdy2fTrEljxlZAU0T2Tg0qmIvS" alt="" width="1" height="1" />


  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003911.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3910" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003910.html">성남+경기도 선불카드 신청 안내 : 이번주는 1인가구 및 미신청자 방문접수</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:23+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  
        <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="https://weblog.youre.space/imyaman/ieii-1/">성남정책</a></li>
  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
        <div>
          <div>[성남정책] 성남+경기도 선불카드 신청 안내 : 이번주는 1인가구 및 미신청자 방문접수</div>
            <div>
              authors: [""]
            </div>
            <div>
              categories: ["시민생각 성남정책"]
            </div>
            <div>
              content: 
            </div>
            <div>
              date_published: 2020-05-11T16:16:38+09:00
            </div>
            <div>
              description: 
            </div>
            <div>
              enclosure: 
            </div>
            <div>
              id: http://seongnamdiary.com/221957066844
            </div>
            <div>
              image: 
            </div>
            <div>
              last_updated: 2020-05-11T16:16:38+09:00
            </div>
            <div>
              links: [{"href"=&gt;"http://seongnamdiary.com/221957066844"}]
            </div>
            <div>
              url: http://seongnamdiary.com/221957066844
            </div>
            <div>
              urls: ["http://seongnamdiary.com/221957066844"]
            </div>
        </div>
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMOZEJgxXF9jydzaDPUnDp26nwkkvJ7SMCjq1GititlQc-2Fx5usFVrlzm8fh2XjFDLU-2B23jvqRMlhvHn546iRm6sURPB9RT2sbWpXmkmW5AMNtHhkvMdOcdLNmeUz49N5IWgvUw5ThQLwzoLAQe3SYxVW5PjY8Uyhkqz4oBEqDegunwoURtXxu4nJFNPw-2FFPcJlrvZfipfbZll2K-2B9zYGP2YtFzjOtU8OSES5ln4mpLvpaw-3D-3D" alt="" width="1" height="1" />


  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003910.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3909" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003909.html">타지역 확진자(강남구#65)관내 이동경로 안내</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:22+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  
        <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="https://weblog.youre.space/imyaman/ieee-1/">이동경로</a></li>
  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      [중앙대책본부 환자·접촉자관리단(2020.03.14)]지침에 의거CCTV 및 카드사용 내역 등을 역학조사관이 검토하여'방문장소 내 접촉자가 없다'는 판단을 하면정보공개 대상에 해당하지 않습니다.이동경로 공개는 증상 발현 또는 증상이 확인되지 않은 경우검체채취 2일 전부터 격리일까지 공개[코로나바이러스감염증-19 대응지침(지자체용)7-4판 개정]확진자 자택과 이동동선 내 방문장소는모두 방역소독을 완료하였습니다.바이러스가 사멸하도록 충분히 소독하였으므로안심하고 이용하시기 바랍니다.강남구#65 강남구 역삼동 거주*5월6일 목간지러움 증상 5월9일 확진판정■이동경로5월5일(화) ~17:24 타지역 동선17:24~18:13 자가용.......
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMPCriscyrQBKS2ZyMdY3TdH-2BmQ4AVClkCPzOMthuibHFFwAH7ehzQLfF8C-2F5FKyTh0flhOTzbo6-2BrihngRD6EEErgVACOe-2BDqN2SfogDYwNjKdwGs07LeVOpCUUSAukop7dTtUSexmPHamD1TlQhRFPQOpAcGJ35LGXPPdh8OoGRdPOTlG274FIl-2F8rcBzQWoMNQGXvheOg8rDNbUrTwGaq" alt="" width="1" height="1" />

  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003909.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3908" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003908.html">Thomas Carlyle</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-12T00:07:16+09:00" itemprop="datePublished">May 12, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      "Necessity dispenseth with decorum."
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMOWIOmaFqnVzV6olBm1x-2BYb4KYaxrpz330qEWTIvCjKtSgSd3Rq4eRTRfXEwbJZLzMVfgPOjpYglM6ikidxKbwES14iIfkGRtQlY88k-2F9vU4n7kPMp7PfdJbiHFq1Pez66mwM9gwUGoIU45sCiwltW6360lXf9x7bus9eJc2veO0BmadozQVuZDSCwzZXlf-2FViqCaHexahHQusK9sWaobkttb03o5DWU4ZIpS-2FT2Kb8Cg-3D-3D" alt="" width="1" height="1" />


  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003908.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3907" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003907.html">IDDD 14장. 애플리케이션</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-11T01:25:26+09:00" itemprop="datePublished">May 11, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      
    <ul>
  <li>사용자 인퍼페이스와 도메인 모델 사이에 위치
    <ul>
      <li>유스케이스 태스크를 조정</li>
    </ul>
  </li>
  <li>트랜잭션, 보안 권한 부여 담당</li>
</ul>

<blockquote>
  <p>애플리케이션을 핵심 도메인 모델과 상호 교류하며 이를 지원하기 위해 잘 조합된 컴포넌트의 집합을 의미하기 위해 사용하고 있다.
이는 일반적으로 도메인 모델 그 자체와 사용자 인터페이스, 내부적으로 사용되는 애플리케이션 서비스, 인프라적 컴포넌트를 뜻한다.
이 각각의 영역에 어떤 것들이 들어가는지는 애플리케이션마다 다르며, 사용하는 아키텍처가 무엇인지에 따라서도 달라진다.</p>
</blockquote>

<p><img src="/images/2018/06/IDDD-figure-14-1.png" alt="특정한 한 가지 아키텍처에 국한되지 않은 주요 애플리케이션 영역. 여전히 각기 다른 영역의 추상화에 의존적인 인프라의 DIP를 강조한다."></p>

<p>그림 14.1 <em>특정한 한 가지 아키텍처에 국한되지 않은 주요 애플리케이션 영역. 여전히 각기 다른 영역의 추상화에 의존적인 인프라의 DIP를 강조한다.</em></p>

<p>ui.Controller -구현-&gt; infra.TomcatController -위임-&gt; application.Service -구현-&gt; infra.TransactionalService -위임-&gt; domain.Repository -구현-&gt; infra.JpaRepository -의존-&gt; infra.Mysql</p>

<ul>
  <li>필자는 UI -&gt; Appcliation -&gt; Infra 순서로 설명해 나간다. (Top-Down 방식)</li>
</ul>

사용자 인터페이스

<p>UI 종류</p>

<ol>
  <li>Web 1.0 렌더링 되는 HTML</li>
  <li>Web 2.0 DHTML + Ajax</li>
  <li>데스크톱 애플리케이션 + HTTP 통신</li>
</ol>

도메인 객체의 렌더링

<p><img src="/images/2018/06/IDDD-figure-14-2.png" alt="사용자 인터페이스는 다수의 애그리게잇 인스턴스의 속성을 렌더링할 필요가 있지만 한 번에 하나의 인스턴스를 수정하도록 요청한다"></p>

<p>그림 14.2 조회 시에는 복수 의 애그리게잇. 명령 시에는 한 개의 애그리게잇</p>

애그리게잇 인스턴스로부터 데이터 전송 객체를 렌더링하기

<p>DTO + Assembler</p>

<blockquote>
  <p>개인적으로 가장 선호하는 방식</p>
</blockquote>

애그리게잇 내부 상태를 발행하기 위해 중재자를 사용하자

<p>중재자 패턴</p>

<blockquote>
  <p>개인적으로 비추 도메인 모델이 (약하긴 하지만) UI에 의존하게 됨</p>
</blockquote>

도메인 페이로드 객체로부터 애그리게잇 인스턴스를 렌더링하라

<p>도메인 객체를 내부에 담고 있는 DPO(Domain Payload Object)로 렌더링 하는 방식</p>

<ul>
  <li>지연로딩 이슈가 있기 때문에 OSIV와 같은 기술과 함께 쓰길 권장한다.</li>
</ul>

애그리게잇 인스턴스의 상태 표현

<p>View Model? Presentation Model?</p>

<blockquote>
  <p>DTO와 차이점을 모르겠다. 상태를 표현한다는 것으로 보아 불변이 가능한 정도 차이인 것인가?</p>
</blockquote>

유스케이스 최적 리파지토리 쿼리

<p>특정 유스케이스에 특화된 쿼리 메소드 제공.</p>

<p>CQRS와 구분하자.</p>

다수의 개별 클라이언트 처리하기

<p>이건 SKIP 하자. 최근의 MVC 프레임워크에서 지원하므로 Application의 책임이 아니라고 본다.</p>

변환 어댑터와 사용자 편집의 처리

<p>Adapter + Command (Or Presentation Model)</p>

<p>주로 명령(편집, 수정) 시에 사용하는 방식</p>

애플리케이션 서비스

<ul>
  <li><strong>애플리케이션 서비스를 얇게 유지(파사드)</strong></li>
  <li><strong>도메인 모델로 위임</strong></li>
</ul>

애플리케이션 서비스 예제

<p>원시타입의 나열 VS <strong>인자 (커맨드) 객체</strong></p>

<ul>
  <li><em>원시타입이 너무 많이 나열되면 그것은 안티패턴이라고 보고 가능하면 인자(Or 커맨드)로 캡슐화 하는 것이 좋아 보인다.</em></li>
</ul>

<blockquote>
  <p>단순 인자이며 명령을 캡슐화 하지 못하는데 커맨드 패턴이라고 부르는 것이 어색해 보인다.</p>
</blockquote>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>identityaccess</span><span>.</span><span>application</span><span>;</span>

<span>class</span> <span>TenantIdentityService</span> <span>{</span>
    <span>@Transactional</span>  <span>// 트랜잭션과 보안 처리</span>
    <span>@PreAuthorize</span><span>(</span><span>"hasRole('SubscriberRepresentative')"</span><span>)</span>
    <span>public</span> <span>void</span> <span>activeTenant</span><span>(</span><span>TenantId</span> <span>tenantId</span><span>)</span> <span>{</span>
        <span>// 도메인 모델로 위임</span>
        <span>this</span><span>.</span><span>nonNullTenant</span><span>(</span><span>tenant</span><span>).</span><span>activate</span><span>();</span>
    <span>}</span>

    <span>@Transactional</span><span>(</span><span>readOnly</span> <span>=</span> <span>true</span><span>)</span>
    <span>public</span> <span>Tenant</span> <span>nonNullTenant</span><span>(</span><span>TenantId</span> <span>tenantId</span><span>)</span> <span>{</span>
        <span>Tenant</span> <span>tenant</span> <span>=</span> <span>this</span><span>.</span><span>tenant</span><span>(</span><span>tenantId</span><span>);</span>
        <span>if</span> <span>(</span><span>tenant</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>
            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span><span>"Tenant does not exists"</span><span>);</span>
        <span>}</span>
        <span>return</span> <span>tenant</span><span>;</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

결합이 분리된 서비스 출력

<div><div><pre>    <span>@Override</span>
    <span>@Transactional</span><span>(</span><span>readOnly</span> <span>=</span> <span>true</span><span>)</span>
    <span>public</span> <span>void</span> <span>findTenant</span><span>(</span><span>TenantId</span> <span>tenantId</span><span>)</span> <span>{</span>
        <span>Tenant</span> <span>teannt</span> <span>=</span> 
                <span>this</span><span>.</span><span>tenantRepository</span><span>.</span><span>tenantOfId</span><span>(</span><span>tenantId</span><span>)</span>
        <span>this</span><span>.</span><span>tenantIdentityOutputPort</span><span>().</span><span>write</span><span>(</span><span>tenant</span><span>);</span>
    <span>}</span>
</pre></div></div>

<p>최근 추세는 어쨋든 사용자에게 출력에 대한 책임은 가능한 UI가 하는 것이 좋다고 본다.
이는 애플리케이션의 책임이 아닌 것 같다.</p>

<blockquote>
  <p>그러한 것은 컴포넌트로 추상화 해서 UI 모듈에 있는 것이 더 어울리는 것 같다. 개인적으로 출력은 반환 값이 있는 것이 더 직관적으로 보인다.</p>
</blockquote>

여러 바운디드 컨텍스트 묶기

<p><img src="/images/2018/06/IDDD-figure-14-3.png" alt="UI에서 다수의 모델을 구성해야만 할 때가 있다. 이 그림에서는 하나의 애플리케이션 계층을 사용해서 세 개의 모델을 구성한다."></p>

<p>그림 14.3 UI에서 다수의 모델을 구성해야만 할 때가 있다. 이 그림에서는 하나의 애플리케이션 계층을 사용해서 세 개의 모델을 구성한다.</p>

<ul>
  <li>애플리케이션 계층이 <strong>유스케이스</strong>를 관리 - UI 계층이 아니다!!</li>
  <li>제품, 토론, 리뷰 컨텍스트가 분리 VS 하나의 컨텍스트로 통합 &gt; <strong>결론은 모델 정제!!</strong>
</li>
</ul>

<p>개인적으로 이러한 상황에서는 UI에서 각각 쿼리 해서 조합하던가, API-GW에서 조합하는 것이 좋다고 본다.</p>

<p>물론 특정 컨텍스트 내에서 조합해야 한다면 <em>애플리케이션 서비스</em>가 가장 어울리는 장소인 것 같다.</p>

인프라

<p><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIf8JCvEJ4zLU3DrmTifFQ-NhNcpf-7Dt2rlMcSeL7CfA2Jd91ONAuIavYNcbNYcfEQLP9PK1gSMbMKcfuBaWK0xCRaaioon91MYI4CJ8bg2uDLorSAjUTtVydhbb3TpTxnUjU9rxmwm6Pbv9Qb5QOd9gL1xWb8ByeipI_ABAa7I2CFyqpnJC0m46lLsIilhkNkGdEkHcPHQb0Tq4ePvcRa5EQcvG6yKOzW5D1ExDtNjCDJYKAcdPuVRRYw7rBmKO8W30000" alt="애플리케이션 서비스는 도메인 모델의 리파지토리 인터페이스에 의존적이지만, 인프라의 구현 클래스를 사용한다. 패키지는 넓은 범위의 책임을 캡슐화 한다"></p>

<p>그림 14.4 애플리케이션 서비스는 도메인 모델의 리파지토리 인터페이스에 의존적이지만, 인프라의 구현 클래스를 사용한다. 패키지는 넓은 범위의 책임을 캡슐화 한다</p>

엔터프라이즈 컴포넌트 컨테이너

<p>EJB VS Spring</p>

마무리

<ul>
  <li>도메인 모델 -&gt; UI 모델</li>
  <li>사용자 입력 -&gt; 도메인 모델</li>
  <li>애플리케이션 서비스의 책임</li>
  <li>DIP로 도메인 모델과 기술(인프라) 분리 및 유연성 확보</li>
</ul>

    <p><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvsZ7YT7GlZSwFaLOZNMYEVMZULJXO0Qdy0OuWnEUod7Hw-3D-3DtHtI_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXsP96XINBjrQgAxMcqimG-2Buu11EN5QAePJ4Rw8zWxFNnjMzDQiE1u9BlnfThclUa1nw0Z4YFZ7UiF-2BYGQkTh8B-2ByGBWSudlHCIPVAwL8HBQxFR-2BRMSbE4wg-2Bwdf-2FRlJkfU0KWsCs1VIc083ObmcaRcrHLVHC7oh0r487gHn5QDiYHJRRoy2zgQ-2FUL16e9uXxzZwYalcBbEhaqpRjK85-2BegP">IDDD 14장. 애플리케이션</a> was originally published by MJ at <a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvvsNBNYnRXmInA7E20V1hcU7ulV_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXsP96XINBjrQgAxMcqimG-2Buu11EN5QAePJ4Rw8zWxFNnhhXSqSJMc1lY4ZGEc4HBsydiFjpfLD443LkE3JNgdvx7qI-2FoNrmHXw9Cgh3D6fJOUdE8RaNFJKGuz67URUdY3-2BTra5sFIKpEAALx6n82de-2BwDKIeRphjG8QWwpKlxAYG424kN-2FdIjSiPbdED1-2BYnDmzz7l31bt1x-2BcHxKE8so8-2F">DevOOOOOOOOP</a> on June 19, 2018.</p>
  
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMNeNVd6tSaTu0o841AtvDOt1DnGuCderuS4ffBd35tylB29xyw-2FcygEygtOMUjbTtQdeE-2BWgM-2FZnSqlTUAdtmpTDllpRpWMIHS3rFRLSqsHJigLdCcSsqDrIpTVOTsjwq7Z7amtIQlmBhl7CYNIaxdACsLIJyuHTR3dcxx0xE5bVE9Rads-2BmiM7LdxS1pGnWV-2BB8RQrQa4sCz6ODDxJKkby" alt="" width="1" height="1" />

  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003907.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3906" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003906.html">IDDD 13장. 바운디드 컨텍스트 통합</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-11T01:25:25+09:00" itemprop="datePublished">May 11, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      
    통합의 기본

<ol>
  <li>API &amp; RPC (RPC, SOAP, WEB/API) : 탄력성이 떨어짐(<em>Legacy</em>)</li>
  <li><strong>메시지</strong></li>
  <li>
<strong>RESTful API</strong>
    <ul>
      <li>1.과 유사하지 않은가? 하지만 필자는 HTTP Verbs 로 차이를 이야기하고 있다.</li>
    </ul>
  </li>
  <li>그 외</li>
</ol>

분산 시스템은 근본적으로 다르다

<p><em>분산 컴퓨팅의 원칙</em></p>

<ul>
  <li>네트워크는 신뢰할 수 없다.</li>
  <li>언제나 지연은 있다.</li>
  <li>대역폭은 무한하지 않다.</li>
  <li>정보와 정책은 다수의 관리자에 걸쳐 퍼져 있다.</li>
  <li>네트워크 전송은 비용이 든다.</li>
  <li>네트워크는 다양성을 갖고 있다.</li>
</ul>

<blockquote>
  <p><strong>왜 원칙인가?</strong></p>
  <ul>
    <li>반드시 해결해야하는 문제점</li>
    <li>계획해야하는 복잡성</li>
    <li>일반적으로 저지르는 <strong>실수가 아님</strong>
</li>
  </ul>
</blockquote>

시스템 경계에 걸친 정보의 교환

<p>결국은 발행된 언어Published Language에 의존해야한다.</p>

<ul>
  <li>정보에서는 인터페이스/클래스가 중요한 것이 아니라 말 그대로 데이터의 특성이 중요</li>
</ul>

<p><strong>예를 들어서</strong></p>

<p>BacklogItemCommitted 알림 이벤트를 발행한다고 하면 아래와 같은 <em>계약</em>을 의미할 것이다.</p>

<table>
  
    <tr>
      <th>정의/속성</th>
      <th>설명</th>
    </tr>
  
  
    <tr>
      <td>타입</td>
      <td>Notification</td>
    </tr>
    <tr>
      <td>포멧</td>
      <td>JSON</td>
    </tr>
    <tr>
      <td>notificationId</td>
      <td>식별자</td>
    </tr>
    <tr>
      <td>typeName</td>
      <td>알림의 타입(BacklogItemCommitted)</td>
    </tr>
    <tr>
      <td>version</td>
      <td>알림 버전</td>
    </tr>
    <tr>
      <td>occurredOn</td>
      <td>발생일시</td>
    </tr>
    <tr>
      <td>event</td>
      <td>본문(Payload)</td>
    </tr>
  
</table>

<p>직렬화 &amp; 역직렬화 자바 소스는 <strong>SKIP</strong></p>

<p><em>중요한 것</em></p>

<ul>
  <li>위와 같은 <em>계약</em>을 통해 컨슈머와 프로슈머가 서로 통신(정보의 교환)을 할 수 있다</li>
  <li>시스템 상호간 의존성이 줄어든다. <em>공유 커널</em>과 비교해보아라
    <ul>
      <li>버전을 통해서 호환성 이슈가 더 없어진다.</li>
    </ul>
  </li>
  <li>위 내용을 <strong>사용자 지정 미디어 타입 계약</strong> 이라 한다.</li>
</ul>

레스트풀 리소스를 사용한 통합

<p><strong>오픈 호스트</strong></p>

<blockquote>
  <p>서비스의 집합으로서 여러분의 서브시스템으로의 액세스를 허용하는 프로토콜을 정의하자.
여러분과 통합해야 하는 모든 사람들이 사용할 수 있도록 프로토콜을 공개하자.
프로토콜을 강화하고 확장해서 새 통합 요구사항을 처리하도록 하자. [Evans]</p>
</blockquote>

<ul>
  <li>결합도를 느슨하게 하기 위해서(자율성) retry와 같은 기법이 요구된다.</li>
</ul>

<p><em>RESTful API 예를 들면</em></p>

<p>특정 사용자의 권한을 조회 /tenants/{tenantId}/users/{username}/inRole/{role}</p>

<ul>
  <li>200 : 권한 있음</li>
  <li>204 : 권한 없음 (404도 괜찮지 않을까?)</li>
</ul>

레스트풀 리소스의 구현

<p>현업에서 우리는 <em>오픈 호스트</em>라고 생각했지만 실상은 <em>공유된 커널</em> 이거나 <em>순응주의자</em>인 경우가 많다.</p>

<p><em>오픈 호스트</em>라면 바운디드 컨텍스트가 의존성이 매우 낮지만 <em>공유된 커널</em>이나 <em>순응주의자</em>는 상당한 결합도를 가지게 되므로 자율성을 위해서 <strong>오픈 호스트</strong> 지향하는 것이 좋다고 본다.</p>

<p><em>UserResource.java</em></p>
<div><div><pre>    <span>@GET</span>
    <span>@Path</span><span>(</span><span>"{username}/inRole/{role}"</span><span>)</span>
    <span>@Produces</span><span>({</span> <span>OvationsMediaType</span><span>.</span><span>ID_OVATION_TYPE</span> <span>})</span>
    <span>public</span> <span>Response</span> <span>getUserInRole</span><span>(</span>
            <span>@PathParam</span><span>(</span><span>"tenantId"</span><span>)</span> <span>String</span> <span>aTenantId</span><span>,</span>
            <span>@PathParam</span><span>(</span><span>"username"</span><span>)</span> <span>String</span> <span>aUsername</span><span>,</span>
            <span>@PathParam</span><span>(</span><span>"role"</span><span>)</span> <span>String</span> <span>aRoleName</span><span>)</span> <span>{</span>

        <span>User</span> <span>user</span> <span>=</span> <span>this</span><span>.</span><span>accessApplicationService</span><span>()</span>
                       <span>.</span><span>userInRole</span><span>(</span>
                               <span>aTenantId</span><span>,</span>
                               <span>aUsername</span><span>,</span>
                               <span>aRoleName</span><span>);</span>

        <span>Response</span> <span>response</span> <span>=</span> <span>this</span><span>.</span><span>userInRoleResponse</span><span>(</span><span>user</span><span>,</span> <span>aRoleName</span><span>);</span>
        <span>return</span> <span>response</span><span>;</span>
    <span>}</span>
</pre></div></div>

<p><em>사용자의 권한을 조회하는 API 응답</em></p>

<div><div><pre>HTTP1.1 200 OK
Content-Type: application/vnd.saasovation.idovation+json
...
{
    "role": "Author",
    "username": "zoe",
    "tenantId": "A94A-...",
    "firstName": "Zoe",
    "lastName": "Doe",
    "emailAddress": "zoe@saasovation.com"
}
</pre></div></div>

부패 방지 게층을 통한 REST 클라이언트 구현

<p><img src="/images/2018/06/IDDD-figure-13-1.png" alt="ID와 액세스 컨텍스트와 협업 컨텍스트의 부패 방지 계층 사이의 통합을 위해 사용된 오픈 호스트 서비스"></p>

<p>그림 13-1 <em>ID와 액세스 컨텍스트와 협업 컨텍스트의 부패 방지 계층 사이의 통합을 위해 사용된 오픈 호스트 서비스</em></p>

<div><div><pre><span>interface</span> <span>CollaboratorService</span> <span>{</span>
    <span>Author</span> <span>authorFrom</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>String</span> <span>identity</span><span>);</span>
    <span>Creator</span> <span>creatorFrom</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>String</span> <span>identity</span><span>);</span>
    <span>Moderator</span> <span>moderatorFrom</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>String</span> <span>identity</span><span>);</span>
    <span>Owner</span> <span>ownerFrom</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>String</span> <span>identity</span><span>);</span>
    <span>Participant</span> <span>participantFrom</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>String</span> <span>identity</span><span>);</span>
<span>}</span>
</pre></div></div>

<p><strong>Java Code</strong></p>
<ul>
  <li><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ocOamlfi77b-2F8VFS2XYE3rNIBQn-2BUMNFIoH1bXWmoo33-2FMUBGC5xDjgevP-2FyijSg-2BWFUjwH2kuZWhmWva9dgDBlGca81HEM2l0wcNOpI73abUqBPCZmzT8H-2FMMrHbEEnOnTu9dP5DiErBT3Cr2xEAuK80jHKLy3RARrYO3sgcbIIm412-2Bv6Fs1Ov9dq-2FN0F2Vo04C6nxhBo2EtVBz71OI9v7l3HS-2FFIGwMuIoFN6S9s-2BkLOmDx7-2BfGK1083Fp3Pb3ShF_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXuNwQPuy17A47h4566AyxWXOwHFnGuK5DxeJvABBoRqvs9Ev6zua5wi96V0YzbB-2FHepY8AfUYRWIBcONuYmZNWHreTeF6DmwiWrciA4HtpALRFJc1uGqiLyicW68-2F2-2Bg4UlSENogDEgE6p8RvS4rGWHDnr6QEYJG8txM0tcGbj0e87GcRiAgJ3h-2Bra6-2BGby-2FcJiuQad1oQBns5iRvoAtOAt">TranslatingCollaboratorService</a></li>
  <li><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ocOamlfi77b-2F8VFS2XYE3rNIBQn-2BUMNFIoH1bXWmoo33-2FMUBGC5xDjgevP-2FyijSg-2BWFUjwH2kuZWhmWva9dgDBlGca81HEM2l0wcNOpI73abUqBPCZmzT8H-2FMMrHbEEnOnTu9dP5DiErBT3Cr2xEAuK80jHKLy3RARrYO3sgcbIIm412-2Bv6Fs1Ov9dq-2FN0F2kpiHvWVHiqKsxG7f8OFH-2BBWS6iEiBhtalK5hK7hlULY-3D2yQ-_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXuNwQPuy17A47h4566AyxWXOwHFnGuK5DxeJvABBoRqvrc9bBra2u9J3wuqs4Ngi9GGTXvvFbfH-2BfSISBJT0b-2FJ-2BLuWBsJtw2czeqF-2BZnA3F49-2F5D1WgRBNRnTaz3mAwXaXQefWogejlfZ68lBvwnGRa0QRSRtTXhEnFJLIXpIOBf9nGK-2FeyNtYvhei6dG6-2FcZJuKgLzZ91hSsZjLWTlEUm">UserInRoleAdapter</a></li>
  <li><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ocOamlfi77b-2F8VFS2XYE3rNIBQn-2BUMNFIoH1bXWmoo33-2FMUBGC5xDjgevP-2FyijSg-2BWFUjwH2kuZWhmWva9dgDBlGca81HEM2l0wcNOpI73abUqBPCZmzT8H-2FMMrHbEEnOnTu9dP5DiErBT3Cr2xEAuK80jHKLy3RARrYO3sgcbIIm412-2Bv6Fs1Ov9dq-2FN0F2H4Ho8-2FOjMkDwW0QJNU1eQyZ1uJjzaNi-2FI8gDC3uSrofrVdc2A6I-2FWOGi3X6Y4eIXEauR_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXuNwQPuy17A47h4566AyxWXOwHFnGuK5DxeJvABBoRqvhmuVwuByWO31wjAg2n8XL4YlqndGJgwBmQEE5tRrwnpmB2XgS-2BOkAQo-2Bv4l9QSTXtQELKK6pH4x-2FlT6Pe5JGqBV8qH4nlbW2uTkPg6HQWItIPQ44p-2B2-2FvJ6Uls-2BeyOUal21bKdhfyDhJKIvzNIEDv-2BzHVegGpyGOPJlCI8HI1jK">CollaboratorTranslator</a></li>
  <li><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ocOamlfi77b-2F8VFS2XYE3rNIBQn-2BUMNFIoH1bXWmoo33-2FMUBGC5xDjgevP-2FyijSg-2BWFUjwH2kuZWhmWva9dgDBlGca81HEM2l0wcNOpI73abUqBPCZmzT8H-2FMMrHbEEnOnTu9dP5DiErBT3Cr2xEAuK80jHKLy3RARrYO3sgcbJXydgPI3oCd3QMs5suRkGiE3hN22GZM-2B3EnTejOTOKA0XLWxgATmvg03blZ3q9d1c-3DxDJe_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXuNwQPuy17A47h4566AyxWXOwHFnGuK5DxeJvABBoRqvvsE0LNhxedodHb8jZKsC7FCJSGOhqzYhDKE6z481k47nSGpg5SAR3pEMlEbhR1E3ai-2FZ6b9MXtXzYIIidfXzy5CF3mYBZtYjGSPUKBdSDh9XJNnJ-2BpLBkqr625LA67TScsYRk9van3Bu0YWVnw46SiWFta50ZtIPRIKVXnF34Gl">Author</a></li>
</ul>

<p>리파지토리를 사용할 수도 있었지만 Author는 엔터티가 아닌 값 객체이므로 부패 방지 계층이 더 어울리다.
반대로 부패 방지 계층에서 애그리게잇(가변성)을 생성한다면 리파지토리가 더 어울린다.</p>

메시징을 사용한 통합

<p>레스트풀 리소스를 이용한 방식보다 <strong>더 높은 수준의 자율성</strong>을 가짐.</p>

<p><strong>도메인 이벤트</strong>를 외부로 발행할 때 좋다.</p>

제품 소유자와 팀 맴버의 정보를 계속해서 제공받는 것

<p>사용자에게 권한을 할당</p>

<ol>
  <li>권한에 사용자를 추가
    <ul>
      <li>AccessService#asignUserToRole(AssignUserToRoleCommand)</li>
      <li>Role#assignUser(User)</li>
    </ul>
  </li>
  <li>사용자에게 권한 할당됨 이벤트 발행 : new UserAssignedToRole()
</li>
  <li>컨텍스트 외부로 이벤트 발행</li>
  <li>AgilePM 컨택스트에서 이벤트를 구독
    <ul>
      <li>TeamMemberEnablerListener#filteredDispatch</li>
      <li>TeamService#enabledProductOwner(EnableProductOwnerCommand)</li>
    </ul>
  </li>
</ol>

당신은 책임을 감당할 수 있는가

<p>외부 바운디드 컨텍스트에서 정보를 (이벤트를 통해서) 복제한 후 그것을 지속적으로 동기화한다. 즉, <strong>데이트를 복사하는 복잡한 책임이 생긴다.</strong></p>

<p>이벤트가 항상 순차적으로 구독자에게 온다는 보장이 없다. 고로 이벤트 처리 시 항상 <em>발생시각</em>을 확인해서 처리해야한다.</p>

<div><div><pre><span>class</span> <span>TeamService</span> <span>{</span>
    <span>@Transactional</span>  <span>// 구독 처리</span>
    <span>public</span> <span>void</span> <span>disableTeamMember</span><span>(</span><span>DisableTeamMemberCommand</span> <span>command</span><span>)</span> <span>{</span>
        <span>TenantId</span> <span>tenantId</span> <span>=</span> <span>new</span> <span>TenantId</span><span>(</span><span>command</span><span>.</span><span>getTenantId</span><span>);</span>
        <span>TeamMember</span> <span>teamMember</span> <span>=</span> 
                <span>teamMemberRepository</span><span>.</span><span>teamMemberOfIdentity</span><span>(</span>
                        <span>tenantId</span><span>,</span> <span>command</span><span>.</span><span>getUsername</span><span>());</span>
        <span>if</span> <span>(</span><span>teamMember</span> <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            <span>// 여기가 중요하다!!!</span>
            <span>teamMember</span><span>.</span><span>disable</span><span>(</span><span>command</span><span>.</span><span>getOccurredOn</span><span>());</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

<span>class</span> <span>Member</span> <span>{</span>
    <span>// 위에 이어서 disable 메서드를 보면</span>
    <span>public</span> <span>void</span> <span>disable</span><span>(</span><span>Date</span> <span>asOfDate</span><span>)</span> <span>{</span>
        <span>if</span> <span>(</span><span>this</span><span>.</span><span>changeTracker</span><span>().</span><span>canToggleEnabling</span><span>(</span><span>oaOfDate</span><span>))</span> <span>{</span>
            <span>this</span><span>.</span><span>setEnabled</span><span>(</span><span>false</span><span>);</span> <span>// enable() 라고 하지..</span>
            <span>this</span><span>.</span><span>setChangeTracker</span><span>(</span>
                <span>this</span><span>.</span><span>changeTracker</span><span>().</span><span>enablingOn</span><span>(</span><span>asOfDate</span><span>));</span>
        <span>}</span>
    <span>}</span>
    <span>public</span> <span>void</span> <span>enable</span><span>(</span><span>Date</span> <span>asOfDate</span><span>)</span> <span>{</span>
        <span>if</span> <span>(</span><span>this</span><span>.</span><span>changeTracker</span><span>().</span><span>canToggleEnablig</span><span>(</span><span>asOfDate</span><span>))</span> <span>{</span>
            <span>this</span><span>.</span><span>setEnabled</span><span>(</span><span>true</span><span>));</span> <span>// disable() 라고 하지..</span>
            <span>this</span><span>.</span><span>setChangeTracker</span><span>(</span>
                <span>this</span><span>.</span><span>changeTracker</span><span>().</span><span>enablingOn</span><span>(</span><span>asOfDate</span><span>));</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>위 처리를 통해서 이벤트 순서가 뒤바껴도 처리에 문제가 없다.</li>
  <li>또한 멱등하게 만드는 역할도 한다.</li>
</ul>

<p>새로운 책임을 알아보자 : <strong>정보 복제는 사소한 책임이 아니다</strong></p>

<p>사용자 정보 복제 시 영향을 미치는 이벤트들</p>

<ul>
  <li>PersonContactInformationChanged</li>
  <li>PersonNameChanged</li>
  <li>UserAssignedToRole</li>
  <li>UserUnassignedFromRole</li>
</ul>

<p>하지만 이외에도</p>

<ul>
  <li>UserEnablementChanged</li>
  <li>TenantActivated</li>
  <li>TenantDeactivated</li>
</ul>

<p>위와 같은 이벤트들이 존재한다.</p>

<p>= <em>가능하면 바운디드 컨텍스트 전반에서 정보의 중복을 최소화하거나 완전히 제거하는 것이 최선이다</em></p>

<p>= 필요할 때 마다 오픈 호스트 서비스와 같은 것을 이용해서 정보를 조회하는 것이 나을수도 있다</p>

<blockquote>
  <p>어쩌란 건지 명확히 이해가 안된다.???
필요한 이벤트 발행을 막을 필요는 없지만 굳이 데이터 중복을 통해서 관리하지 말고 이벤트는 이벤트대로 사용하고, 데이터는 필요할 때 마다 조회하는 것이 낫다는 것인가?</p>
</blockquote>

장기 실행 프로세스와 책임의 회피

<p>다른 바운디드 컨텍스트에게 데이터 생성 책임을 지게 하고, 단순하게 레코드 시스템이 그 고유한 정보를 처리하게 할 것이다. 
즉, <strong>책임을 네트워크 건너로 차버린다.</strong></p>

<p><em>제품을 생성하는 유스케이스를</em> 살펴본다</p>

<ol>
  <li>사용자는 제품 설명 정보를 제공한다.</li>
  <li>사용자는 팀토론에 대한 의사를 표시한다.</li>
  <li>사용자는 정의된 제품을 만들도록 요청한다.</li>
  <li>시스템은 포럼과 <strong>토론</strong>이 들어간 제품을 만든다.</li>
</ol>

<p><strong>애자일 프로젝트 관리 컨텍스트에서</strong></p>

<p><img src="http://www.plantuml.com/plantuml/svg/ZP7DIaGn38NtUOg-m7q15yF0k5JmP-4wqnwzWTfUcrJnxGrSos0HTDdpdPEVzAZ6pVfh9evMMpXbGJ7QN9Ge6nSBTwsc7kqHxLqYVaFa4R7FyJmri25HhCLQpKE-5erTLMfvm5k7kkL6r53GVXIzXIg_O4yvIsnyPiK0znqTj0yQbiCqNxWA1H_VsfFOUcbBa_EItKE3EvXMSRxrSnPTQGABU__Up_FFaWqDoLqRMrpf7wdbC1_32obAebbUXdMSv-Wk_zKl" alt="애자일 프로젝트 관리 컨텍스트에서 흐름도"></p>

<p>ProjectService#newProductWithDiscussion(NewProductCommand)</p>

<ul>
  <li>
Product와 ProductDiscussion을 생성</li>
  <li>
ProductCreated 이벤트 발행
    <ul>
      <li>
Discussion#availablity#isRequested(토론 가능 상태)가 참이면 <strong>장기 프로세스를 시작</strong> 한다.</li>
      <li>장기 실행 프로세스 == 상품 토론을 생성</li>
    </ul>
  </li>
  <li>추후에 구매를 통해서 토론을 생성할 수도 있다. Product#requestDiscussion(DiscussionAvailablity)
    <ul>
      <li>
ProductDiscussionRequested 이벤트 발행</li>
    </ul>
  </li>
</ul>

<p>그렇다면 사용 가능 상태가 REQUESTED가 아니라면 이 이벤트의 발행의 의미가 있는가?</p>

<p>&gt; 이것에 대한 책임은 이벤트 구독자가 갖는다.</p>

<p>ProductDiscussionRequestedListener#listensToEvents</p>

<ul>
  <li>
ProductCreated, ProductDiscussionRequested 이벤트를 수신한다.</li>
</ul>

<p>ProductDiscussionRequestedListener</p>

<div><div><pre>    <span>protected</span> <span>void</span> <span>filteredDispatch</span> <span>(</span><span>String</span> <span>type</span><span>,</span> <span>String</span> <span>textMessage</span><span>)</span> <span>{</span>
        <span>// 토론 사용 가능상태가 아니면 이벤트 처리 없음</span>
        <span>if</span> <span>(!</span><span>reater</span><span>.</span><span>eventBooleanValue</span><span>(</span><span>"requestingDiscussion"</span><span>))</span> <span>{</span>
            <span>return</span><span>;</span>
        <span>}</span>
        <span>...</span>
        <span>// CreateExclusiveDicussion 커맨드를 만들어 협업 컨텍스트에 메시징 인프라를 통해서 이벤트 발행</span>
        <span>this</span><span>.</span><span>messageProducer</span><span>().</span><span>send</span><span>(...);</span>
    <span>}</span>
</pre></div></div>

<p>여기서 잠깐</p>

<ul>
  <li>애자일 프로젝트 관리 컨텍스트에서 Product 애그리게잇에서 발행된 이벤트(ProductCreated)를 구독할 리스터를 만들 필요가 있을까?
    <ul>
      <li>차라리 협업 컨텍스트에서 ProductCreated 이벤트를 바로 구독하는 것이 낫지 않을까?</li>
      <li>그런데 ProductCreated는 협업 컨텍스트의 유비쿼터스 언어와 어울리지 않고, 이 이벤트가 Forum과 Discussion을 생성하게 한다는 것을 연결시키는 것이 힘들다.</li>
      <li>고로 협업 컨텍스트 입장에서 CreateExclusiveDicussion 명령을 이벤트로 받는 것이 어색하지 않다.</li>
    </ul>
  </li>
</ul>

<p><strong>협업 컨텍스트에서</strong></p>

<p><img src="http://www.plantuml.com/plantuml/svg/ZP5DJaCn38JtFaKkq7S05gWIFojOe9uWBsy4bjBaAROBt1u72JNbWTHLf9dFav6z5urDxPXfYHhdA0ZF48clU34OADMYhURmy96o2Pzmpv9CX6kvQuZgxnEBeg3HwacSU8r5msDjTZoWdJXXQrmevqH2KTRFGJdqTbY8nb9Xjxkzfb2u2MApfCOpw1hUOyVUVRx_FqtJq74a_flurlucVv3VYHquQquLlDCWkBrPYrEhpPdbZRQUB-dob7kKnG_z1G00" alt="협업 컨텍스트에서 흐름도"></p>

<p>ExclusiveDiscussionCreationListener#filteredDispatch(String, String)</p>

<ul>
  <li>위에서 이어 애자일 프로젝트 관리 컨텍스트에서 발행한 CreateExclusiveDicussion를 구독</li>
  <li>
ForumService#startExclusiveForumWithDiscussion를 호출해서 Forum과 Discussion을 생성
    <ul>
      <li>생성과 동시에 DiscussionStarted 이벤트를 발행한다.</li>
    </ul>
  </li>
</ul>

<p><strong>다시 애자일 프로젝트 관리 컨텍스트로 돌아와서</strong></p>

<p><img src="http://www.plantuml.com/plantuml/svg/VP1D2i8m48NtSufSe1TmKRfm8oWeFK5-7ZfGavAP2DxU24gaj2uV-RwybmoYDckvJnIiMcS5vWGHUyMbe81yYfhJPFOileXmYkDRG3YoA28opJMovzb6DUUSGl4w8Z_OO-s849Nr-OtjsaDaPQi8HBy3JDVrs-LcPwGuyPaTQ9lg-iMowl6dhrcqO9hr5s_SsckgEXStiTneG0prery0" alt="다시 애자일 프로젝트 관리 컨텍스트에서 흐름도"></p>

<p>DiscussionStartedListener#filteredDispatch(String, String)</p>

<ul>
  <li>협업 컨텍스트에서 발행한 DiscussionStarted 이벤트를 구독한다.</li>
</ul>

<p>이어서 ProductService#initiateDiscussion(InitiateDiscussionCommand)</p>

<ul>
  <li>
Product#initiateDiscussion 를 실행해서 아까 생성한 Product에서 Discussion 생성 상태 변경
    <ul>
      <li>당연히 멱등하다. 이미 Discussion을 생성해서 READY 상태라면 아무일도 일어나지 않는다. 즉 REQUESTED 상태에서만 이하 작업이 실행된다.</li>
      <li>그리고 ProductDiscussionInitiated 이벤트를 발행한다.</li>
    </ul>
  </li>
</ul>

<p>여기서 잠깐</p>

<ul>
  <li>이 장기 실행 프로세스는 네트워크를 건너서 통신하고 메시징 인프라에 의존하는데 여기에 문제가 생기면 어떻게 될까?</li>
  <li>즉 프로세스가 끝까지 실행한다고 확신할 수 있을까?</li>
</ul>

프로세스 상태 머신과 타임아웃 트래커

<p>위 문제점 해결을 위해서 타임아웃 트래커가 필요하게 된다.</p>

<p><em>타입아웃 트래커</em></p>

<p>트래커는 완료까지 부여된 시간이 만료된 프로세스를 감시하는데. 이런 프로세스는 만료되기 전까지 몇번이고 재시도될 수 있다. 
트래커는 원하는 경우 고정된 시간 간격을 재시도하도록 설계할 수 있고, 재시도를 전혀 하지 않거나 정해진 횟수만큰을 재시도한 후에 타임아웃을 발생시키도록 할 수도 있다.
<em>기술적 서브도메인의 일부다</em></p>

<p><img src="http://www.plantuml.com/plantuml/svg/XP5HIiSm38VVUufUm0liGGRwCX2KkGkK9W_1BTa_IGLlRmiAhbHzAQ7zVUdNT3PFwkNOGnPsbJs-g439_aYMYna9htWhQ8xmH7Lbr71MX3ATYVqx_ehwJXdxeunccwRyXhhYAKOk-d49RNJWWx2v9cA4AnD7LuNmlsAyk-_CuXJRKtz02vDJybg5BbhXlxMcVaeiNmgDW-VYWvQ_ZQDsIm1ZeEqqSnnwBn1cPAY_zma0" alt="상품의 토론 생성 흐름도 with 타임아웃 트래커"></p>

<p>ProductService#startDiscussionInitiation</p>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>agilepm</span><span>.</span><span>application</span><span>;</span>

<span>class</span> <span>ProductService</span> <span>{</span>
    <span>@Transactional</span>
    <span>public</span> <span>void</span> <span>startDiscussionInitiation</span><span>(</span>
            <span>StartDiscussionInitiationComman</span> <span>command</span><span>)</span> <span>{</span>
        <span>Product</span> <span>product</span> <span>=</span> <span>productRepository</span><span>.</span><span>findById</span><span>(...)</span>
        
        <span>TimeConstrainedProcessTracker</span> <span>tracker</span> <span>=</span> <span>new</span> <span>TimeConstrainedProcessTracker</span><span>(</span>
                <span>product</span><span>.</span><span>tenantId</span><span>().</span><span>id</span><span>,</span>
                <span>ProcessId</span><span>.</span><span>newProcessId</span><span>(),</span>
                <span>"Create discussion for product : "</span> <span>+</span> <span>product</span><span>.</span><span>name</span><span>(),</span>
                <span>new</span> <span>Date</span><span>(),</span>
                <span>5L</span> <span>*</span> <span>60L</span> <span>*</span> <span>1000L</span><span>,</span> <span>// 5분 마다 재시도</span>
                <span>3</span><span>,</span>                <span>// 총 3회 재시도한다.</span>
                <span>ProductDiscussionRequestTimedOut</span><span>.</span><span>class</span><span>);</span>

        <span>processTrackerRepository</span><span>.</span><span>add</span><span>(</span><span>tracker</span><span>);</span>  <span>// 타임아웃 트래커 등록</span>
        
        <span>product</span><span>.</span><span>setDiscussionInitiationId</span><span>(</span>
                <span>tracker</span><span>.</span><span>processId</span><span>().</span><span>id</span><span>());</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<p><strong>상품의 토론 타임아웃 or 재시도 흐름도</strong></p>

<p><img src="http://www.plantuml.com/plantuml/svg/dOzTgi8m44RViufiuDu5-20jj8L2GL4t49EvC90Vd9aKkdldHG8g2lSb9EISR-RhM1n9JT6uA5OmGQbYh3rI2TNBWEmhCvPy0g5jGHR8GFPd_o3EG2jwiBidkNszXHbo69F3E1Mwg1WELHJomFmfGCq_bTfQSqP19tfhMkEbWMgsHxzgYBjYHDb-ftvUni50PB04sl9VzPlwlJp1hGBBon03EPXEZvhY7G00" alt="상품의 토론 타임아웃 or 재시도 흐름도 with 타임아웃 트래커"></p>

<p><strong>마지막에 상품과 토론이 정상적으로 생성되면 흐름도</strong></p>

<p><img src="http://www.plantuml.com/plantuml/svg/ZOun3i8m34Ntd28Nu08Cg1AC34Zj1IBd3nQ94zaEvwTC5HKWHlk_x-V9FAcFMW8rSMqbNjXec76J-HKXNzaS0Wrz7Pcu9_5uqvO7-GnzCE5JzBPRkEBSn5mJ2_AA4CmMJNI7Xl3L6G-ddIeU8mix9yVM2ZjcQ_sB_tnmFKAjzW973XCaZrgU" alt="상품과 토론이 정상적으로 생성 시 흐름도"></p>

<ul>
  <li>애자일 프로젝트 관리 컨텍스트에서 마지막으로 상품의 토론이 정상적으로 생성되면 <strong>타임아웃 트래커를 완료</strong> 시켜야 한다.</li>
  <li>이것으로 프로세스는 끝난다.</li>
</ul>

<p><em>위 장기 실행 프로세스의 문제점과 해결책</em></p>

<ul>
  <li>동일한 CreateExclusiveDiscussion 커맨드가 여러 번 발송된다.
    <ul>
      <li>멱등성을 지켰기 때문에 문제가 없을 것 같다.</li>
      <li>하지만 애자일 프로젝트 관리 컨텍스트가 실패한다면 문제가 발생할 수 있다.</li>
      <li>결국 협업 컨텍스트의 ExclusiveDiscussionCreationListener가 멱등한 애플리케이션 서비스 메서드로 작업을 위임할 수 있다면 많은 문제점을 해결할 수 있다.</li>
    </ul>
  </li>
</ul>

<p><img src="http://www.plantuml.com/plantuml/svg/ZP5DJaCn38JtFaKkq7S05gWIFojOe9uWBsy4bjBaAROBt1u72JNbWTHLf9dFav6z5urDxPXfYHhdA0ZF48clU34OADMYhURmy96o2Pzmpv9CX6kvQuZgxnEBeg3HwacSU8r5msDjTZoWdJXXQrmevqH2KTRFGJdqTbY8nb9Xjxkzfb2u2MApfCOpw1hUOyVUVRx_FqtJq74a_flurlucVv3VYHquQquLlDCWkBrPYrEhpPdbZRQUB-dob7kKnG_z1G00" alt="협업 컨텍스트에서 흐름도"></p>

<ul>
  <li>위 흐름도 기준에서 startForum, startDiscusssion 행위가 멱등하면 해결된다.</li>
</ul>

좀 더 복잡한 프로세스 설계하기

<p>복잡한 상황에서 다수의 완료 단계가 필요하게 된다면 <strong>상태 머신</strong>이 좋은 선택</p>

<div><div><pre><span>Proces</span> <span>process</span> <span>=</span> <span>new</span> <span>TestableTimeConstrainedProcess</span><span>(</span>
        <span>TENANT_ID</span><span>,</span>
        <span>ProcessId</span><span>.</span><span>newProcessId</span><span>(),</span>
        <span>"Testable Time Constrained Process"</span><span>,</span>
        <span>5000L</span><span>);</span> <span>// 재시도 없이 5초 내로 완료되야 한다.</span>

<span>TimeConstrainedProcessTracker</span> <span>tracker</span> <span>=</span> 
        <span>process</span><span>.</span><span>timeConstrainedProcessTracker</span><span>();</span>
    
<span>process</span><span>.</span><span>confirm1</span><span>();</span>

<span>assertFalse</span><span>(</span><span>process</span><span>.</span><span>isCompleted</span><span>());</span>
<span>assertFalse</span><span>(</span><span>process</span><span>.</span><span>didProcessingComplete</span><span>());</span>
<span>assertEquals</span><span>(</span><span>process</span><span>.</span><span>processCompletionType</span><span>(),</span> <span>ProcessCompletionType</span><span>.</span><span>NotCompleted</span><span>);</span>

<span>process</span><span>.</span><span>confirm2</span><span>();</span>

<span>assertTrue</span><span>(</span><span>process</span><span>.</span><span>isCompleted</span><span>());</span>
<span>assertTrue</span><span>(</span><span>process</span><span>.</span><span>didProcessingComplete</span><span>());</span>
<span>assertEquals</span><span>(</span><span>process</span><span>.</span><span>processCompletionType</span><span>(),</span> <span>ProcessCompletionType</span><span>.</span><span>CompletedNormally</span><span>);</span>
<span>assertNull</span><span>(</span><span>process</span><span>.</span><span>timedOutDate</span><span>());</span>

<span>tracker</span><span>.</span><span>informProcessTimedOut</span><span>();</span>    <span>// 어짜피 이미 완료되어 있으므로 아무처리가 없을 것</span>
<span>assertFalse</span><span>(</span><span>process</span><span>.</span><span>isTimedOut</span><span>());</span>  <span>// 즉 타임아웃 되지 않았으므로 언제나 false</span>
</pre></div></div>

<ul>
  <li>
TestableTimeConstrainedProcess는 재시도 없이 5초 내로 완료되야 한다.</li>
  <li>
confirm1(), confirm2()만 호출된다면 완전히 완료 상태로 표시된다.
    <ul>
      <li>내부적으로 2가지 상태를 속성으로 지니고 있다.</li>
      <li>즉, confirm1, confirm2 둘 다 true 여야지 완료 상태</li>
    </ul>
  </li>
</ul>

메시징이나 시스템을 활용할 수 없을 때

<ul>
  <li>
<strong>고가용성 확보</strong>가 최선이다.</li>
  <li>메시징인프라가 죽었다가 다시 살아났을때 <em>자동으로 리스너가 재활성화</em> 될 수록 해야한다.</li>
</ul>

마무리

<ul>
  <li>분산 컴퓨팅에서의 통합</li>
  <li>RESTful VS 메시징인프라</li>
  <li>장기 수행 프로세스
    <ul>
      <li>Retry와 타임아웃</li>
      <li><strong>멱등성</strong></li>
      <li>복잡한 상태를 해결해주는 <em>상태 머신</em>
</li>
    </ul>
  </li>
</ul>

    <p><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvuY5o8sPLUqcwUlwpl5XNl7Ye1WW5seiWfrTpztkwbflw-3D-3DaTnf_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXuNwQPuy17A47h4566AyxWXOwHFnGuK5DxeJvABBoRqvs1IPwSYly7DOdls8ZwW-2BNwqQNDKH4Ofckm8f3ETffEP82SE0GZE9oploxbK7PPgW5UcKPpfj5lv3LdC-2BTt0NOr2ivQOInJC3L2ZVPAB8Zbp6BeFCkzYWXwrwOQizYMSJ0Jqd5cz3Zwd30BeMOZtNxCvStkUlTcpReN9lSUOXzik">IDDD 13장. 바운디드 컨텍스트 통합</a> was originally published by MJ at <a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvvsNBNYnRXmInA7E20V1hcUwXEq_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXuNwQPuy17A47h4566AyxWXOwHFnGuK5DxeJvABBoRqvmreKUgdKoC1UUUBUQ9uKcKpEIDWHU6pjCwigWsxMzgiAvZeM-2FISnwnU6bRNblMdREm4Ocohi8KIcxNZsInF2jcJbbZxWk7IBkxwvYSPC02TaJjQONC9iqI-2FL0uALXqHQJ57zK-2FkxHHi4Sj3gX1auUpo8KAeTDbYBVQ-2BX5s4NIsM">DevOOOOOOOOP</a> on June 16, 2018.</p>
  
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMMPHUrvqy27s2W1GPFoCCYCenxBUWgk5LhrGB1Q9ISF0rb72mc-2BCHAj2CX9WHXObUhlt278zi0PAiaGDnhABd7LxbH8oG3D3pJ00agVFBacz9lYIPJXSrXxNHHMCh4yCq5scS2rZSpePBJnX7BZ0HPBvdY8mJZDvQ8ejWWIIilf-2FnNl-2FypA2Es08INq1m0QSOuu4fGeAaFRvGouMQojSrdJ" alt="" width="1" height="1" />

  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003906.html" itemprop="url">Continue reading</a>
  </div>
</article>


              <article id="entry-3905" class="entry-asset entry asset hentry" itemscope itemType="http://schema.org/BlogPosting">
  <div class="asset-header">
    <h2 class="asset-name entry-title" itemprop="name"><a href="https://weblog.youre.space/imyaman/2020/05/003905.html">IDDD 12장. 리파지토리</a></h2>
    <footer class="asset-meta">
      <ul class="asset-meta-list">
        <li class="asset-meta-list-item">Posted on <time datetime="2020-05-11T01:25:24+09:00" itemprop="datePublished">May 11, 2020</time></li>
        <li class="asset-meta-list-item">by <span class="author entry-author vcard">hal9000</span></li>

  

      </ul>
    </footer>
  </div>
  <div class="asset-content entry-content" itemprop="articleBody">
    

  
    
  
  
      
    <blockquote>
  <p>전역(global) 액세스가 필요한 각 객체의 타입이다, 해당 타입의 모든 객체가 담긴 인메모리 컬렉션이란 허상을 제공하는 객체를 생성하자.
잘 알려진 전역의 인터페이스를 통한 액세스를 설정하자.
객체를 추가하거나 제거하는 메소드를 제공하자…
일정 조건에 부합되는 특성을 갖는 객체를 선택해 완전히 인스턴스화된 객체나 여러 객체의 컬렉션으로 반환하는 메소드를 제공하자…
애그리게잇에 대해서만 리파지토리를 제공하자.. [Evans]</p>
</blockquote>

<p>애그리게잇 : 리파지토리 = 1(..N):1</p>

컬렉션 지향 리파지토리

<div><div><pre><span>package</span> <span>java</span><span>.</span><span>util</span><span>;</span>

<span>public</span> <span>interface</span> <span>Collection</span> <span>{</span>
    <span>public</span> <span>boolean</span> <span>add</span><span>(</span><span>Object</span> <span>o</span><span>);</span>
    <span>public</span> <span>boolean</span> <span>addAll</span><span>(</span><span>Collection</span> <span>c</span><span>);</span>
    <span>public</span> <span>boolean</span> <span>remove</span><span>(</span><span>Object</span> <span>o</span><span>);</span>
    <span>public</span> <span>boolean</span> <span>removeAll</span><span>(</span><span>Collection</span> <span>c</span><span>);</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>같은 인스턴스를 두번 추가되도록 허용해서는 안된다.</li>
  <li>
<em>재저장</em>을 할 필요가 없다.
    <ul>
      <li>그저 객체의 상태를 변경시키면 자동으로 저장될 뿐이다.</li>
    </ul>
  </li>
  <li>결국 Set처럼 행동해야 한다.</li>
</ul>

<p><em>재저장</em>할 필요가 없다면 객체의 상태를 추적해야한다.</p>

<p><em>영속성 매커니즘의 암시적 변경 추적 기법</em></p>

<ul>
  <li>암시적 읽기 시 복사(Copy-on-Read) : 읽을 때 복사본을 만들어 두고 복사본과 비교해서 변경된 것이 있으면 Commit 시킨다.</li>
  <li>암시적 쓰기 시 복사(Copy-on-Write) : 프록시로 감싸두고 Dirty(상태 변경이 되면)인 경우 Commit 시킨다.</li>
</ul>

하이버네이트 구현

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>collaboration</span><span>.</span><span>domain</span><span>.</span><span>model</span><span>.</span><span>calendar</span><span>;</span>    <span>//!!</span>

<span>interface</span> <span>CalendarEntryRepository</span> <span>{</span>
    <span>void</span> <span>add</span><span>(</span><span>CalendarEntry</span> <span>calendarEntry</span><span>);</span>
    <span>void</span> <span>addAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>CalendarEntry</span><span>&gt;</span> <span>calendarEntries</span><span>);</span>
    <span>void</span> <span>remove</span><span>(</span><span>CalendarEntry</span> <span>calendarEntry</span><span>);</span>
    <span>void</span> <span>removeAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>CalendarEntry</span><span>&gt;</span> <span>calendarEntries</span><span>);</span>

    <span>CalendarEntry</span> <span>calendarEntryOfId</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>CalendarEntriyId</span> <span>id</span><span>);</span>
    <span>Collection</span><span>&lt;</span><span>CalendarEntry</span><span>&gt;</span> <span>calendarEntriesOfCalendar</span><span>(</span>
        <span>Tenant</span> <span>tenant</span><span>,</span> <span>CalendarId</span> <span>calendarId</span><span>);</span>
    <span>Collection</span><span>&lt;</span><span>CalendarEntry</span><span>&gt;</span> <span>overlappingCalendarEntries</span><span>(</span>
        <span>Tenant</span> <span>tenant</span><span>,</span> <span>CalendarId</span> <span>calendarId</span><span>,</span> <span>TimeSpan</span> <span>timeSpan</span><span>);</span>

    <span>CalendarEntryId</span> <span>nextIdentity</span><span>();</span>
<span>}</span>
</pre></div></div>
<ul>
  <li>
package는 도메인 모델과 함께한다.</li>
  <li>물리적 삭제 VS <strong>논리적 삭제</strong>
</li>
</ul>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>collaboration</span><span>.</span><span>infrastructure</span><span>.</span><span>persistence</span><span>;</span>

<span>public</span> <span>class</span> <span>HibernateCalendarEntryRepository</span> 
        <span>implements</span> <span>CalendarEntryRepository</span> <span>{</span>
    
    <span>private</span> <span>final</span> <span>SpringHibernateSessionProvider</span> <span>sessionProvider</span><span>;</span>

    <span>public</span> <span>HibernateCalendarEntryRepository</span><span>(</span>
            <span>SpringHibernateSessionProvider</span> <span>sessionProvider</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>sessionProvider</span> <span>=</span> <span>sessionProvider</span><span>;</span>
    <span>}</span>

    <span>private</span> <span>org</span><span>.</span><span>hibernate</span><span>.</span><span>Session</span> <span>session</span><span>()</span> <span>{</span>
        <span>return</span> <span>this</span><span>.</span><span>sessionProvider</span><span>.</span><span>session</span><span>();</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>add</span><span>(</span><span>CalendarEntry</span> <span>calendarEntry</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>session</span><span>().</span><span>saveOrUpdate</span><span>(</span><span>calendarEntry</span><span>);</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>addAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>CalendarEntry</span><span>&gt;</span> <span>calendarEntries</span><span>)</span> <span>{</span>
        <span>for</span> <span>(</span><span>CalendarEntry</span> <span>each</span> <span>:</span> <span>calendarEntries</span><span>)</span> <span>{</span>
            <span>this</span><span>.</span><span>session</span><span>().</span><span>saveOrUpdate</span><span>(</span><span>each</span><span>);</span>
        <span>}</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>remove</span><span>(</span><span>CalendarEntry</span> <span>calendarEntry</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>session</span><span>().</span><span>delete</span><span>(</span><span>calendarEntry</span><span>);</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>removeAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>CalendarEntry</span><span>&gt;</span> <span>calendarEntries</span><span>)</span> <span>{</span>
        <span>for</span> <span>(</span><span>CalendarEntry</span> <span>each</span> <span>:</span> <span>calendarEntries</span><span>)</span> <span>{</span>
            <span>this</span><span>.</span><span>session</span><span>().</span><span>delete</span><span>(</span><span>each</span><span>);</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>package : infrastructure.persistence
</li>
  <li>
Set과 유사한 행위 제공</li>
  <li>
Cascade를 통한 연관된 엔터티를 같이 변경하는 기능도 있음</li>
  <li>복잡한 조회의 경우 HQL을 이용
    <ul>
      <li>하지만 JPA를 사용한다면 JPQL을 사용하나, 현재까지는 querydsl 과 같은 기술이 좋은 것 같다.</li>
    </ul>
  </li>
</ul>

탑링크 구현에 대한 고려

<p>탑링크는 명시적으로 <a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ocOamlfi77b-2F8VFS2XYE3jvomhKARsqEFt5OzuMEla3OxFq7N8A2S9XgKdEV6E3vgwYgi4nZFLPZR0EX6t7X2A-3D-3DwMW5_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXvwW4pdWHXONtD5tHoCXDUmj1qJCikhDwd8NNdKKxbaMrFCtRE0iiXICK85SGiKLO3e-2BizR1hG7yPdCCPJxvqRzA9LXigtOhL5iC0INcvtl0I-2BwhFkZLPx93KoArmnh0ycfUhuN-2FCTmHx9tvIXRZGj73o1Owu0kNsAw49pu8pt0-2FSJ-2FGDym59Qb7s9gAO19hAp8gaHn2eEHJu-2F44M1GCEqv">작업단위(Unit of work)</a>를 지정할 수 있다.</p>

<ul>
  <li>일종의 트랜잭션의 범위를 추상화 시킨 것</li>
</ul>

<div><div><pre><span>Calendar</span> <span>calendar</span> <span>=</span> <span>session</span><span>.</span><span>readObject</span><span>(...);</span>
<span>UnitOfWork</span> <span>work</span> <span>=</span> <span>session</span><span>.</span><span>acquireUnitOfWork</span><span>();</span>
<span>Calendar</span> <span>calendarToRename</span> <span>=</span> <span>work</span><span>.</span><span>registerObject</span><span>(</span><span>calendar</span><span>);</span>
<span>calendarToRename</span><span>.</span><span>rename</span><span>(</span><span>"CollabOvation Project Calendar"</span><span>);</span>
<span>work</span><span>.</span><span>commit</span><span>();</span>
</pre></div></div>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>collaboration</span><span>.</span><span>infrastructure</span><span>.</span><span>persistence</span><span>;</span>

<span>public</span> <span>class</span> <span>ToplinkCalendarEntryRepository</span> 
        <span>implements</span> <span>CalendarEntryRepository</span> <span>{</span>
    <span>@Override</span>
    <span>public</span> <span>void</span> <span>add</span><span>(</span><span>Calendar</span> <span>calendar</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>unitOfWork</span><span>().</span><span>registerNewObject</span><span>(</span><span>calendar</span><span>);</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>editingCopy</span><span>(</span><span>Calendar</span> <span>calendar</span><span>)</span> <span>{</span>
        <span>return</span> <span>(</span><span>Calendar</span><span>)</span> <span>this</span><span>.</span><span>unitOfWork</span><span>().</span><span>registerObject</span><span>(</span><span>calendar</span><span>);</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

영속성 지향의 리파지토리

<ul>
  <li>컬렉션 지향 리파지토리 : Set
</li>
  <li>영속성 지향 리파지토리 : HashMap
    <ul>
      <li>하지만 꼭 put를 해야한다. - 원자적 쓰기를 통제할 수 없음(트랜잭션 없음)</li>
    </ul>
  </li>
</ul>

<p>No-Sql 종류가 많다.</p>

<ul>
  <li>잼파이어</li>
  <li>코히어런스</li>
  <li>몽고DB</li>
  <li>리악</li>
</ul>

코히어런스 구현

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>agilepm</span><span>.</span><span>domain</span><span>.</span><span>model</span><span>.</span><span>product</span><span>;</span>

<span>interface</span> <span>ProductRepository</span> <span>{</span>
    <span>ProductId</span> <span>nextIdentity</span><span>();</span>
    <span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>allProductsOfTenant</span><span>(</span><span>Tenant</span> <span>tenant</span><span>);</span>
    <span>Product</span> <span>productOfId</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>ProductId</span> <span>productId</span><span>);</span>
    <span>void</span> <span>remove</span><span>(</span><span>Product</span> <span>product</span><span>);</span>
    <span>void</span> <span>removeAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>products</span><span>);</span>
    <span>void</span> <span>save</span><span>(</span><span>Product</span> <span>product</span><span>);</span>
    <span>void</span> <span>saveAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>products</span><span>);</span>
<span>}</span>
</pre></div></div>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>agilepm</span><span>.</span><span>infrastructure</span><span>.</span><span>persistence</span><span>;</span>

<span>class</span> <span>CoherenceProductRepository</span> 
        <span>implements</span> <span>ProductRepository</span> <span>{</span>
    <span>private</span> <span>Map</span><span>&lt;</span><span>Tenant</span><span>,</span> <span>NamedCache</span><span>&gt;</span> <span>caches</span><span>;</span>

    <span>public</span> <span>CoherenceProductRepository</span><span>()</span> <span>{</span>
        <span>this</span><span>.</span><span>caches</span> <span>=</span> <span>new</span> <span>HashMap</span><span>&lt;&gt;();</span>
    <span>}</span>

    <span>private</span> <span>synchronized</span> <span>NamedCache</span><span>(</span><span>TenantId</span> <span>tenantId</span><span>)</span> <span>{</span>
        <span>NamedCache</span> <span>cache</span> <span>=</span> <span>this</span><span>.</span><span>caches</span><span>.</span><span>get</span><span>(</span><span>tenantId</span><span>);</span>
        <span>if</span> <span>(</span><span>cache</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>
            <span>// ageilepm:Product:TenantId</span>
            <span>// 1단계 : 2단계 : 3단계</span>
            <span>cache</span> <span>=</span> <span>CacheFactory</span><span>.</span><span>getCache</span><span>(</span>
                <span>"agilepm.Product."</span> <span>+</span> <span>tenantId</span><span>.</span><span>id</span><span>(),</span>
                <span>Product</span><span>.</span><span>class</span><span>.</span><span>getClassLoader</span><span>());</span>
            <span>this</span><span>.</span><span>caches</span><span>.</span><span>put</span><span>(</span><span>tenantId</span><span>,</span> <span>cache</span><span>);</span>
        <span>}</span>
        <span>return</span> <span>cache</span><span>;</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>save</span><span>(</span><span>Product</span> <span>product</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>cache</span><span>(</span><span>product</span><span>.</span><span>tenantId</span><span>())</span>
            <span>.</span><span>put</span><span>(</span><span>this</span><span>.</span><span>idOf</span><span>(</span><span>product</span><span>),</span> <span>product</span><span>);</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>saveAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>products</span><span>)</span> <span>{</span>
        <span>Map</span><span>&lt;</span><span>String</span><span>,</span> <span>Product</span><span>&gt;</span> <span>productsMap</span> <span>=</span> 
            <span>new</span> <span>HashMap</span><span>&lt;&gt;(</span><span>products</span><span>.</span><span>size</span><span>());</span>
        <span>for</span> <span>(</span><span>Product</span> <span>each</span> <span>:</span> <span>products</span><span>)</span> <span>{</span>
            <span>if</span> <span>(</span><span>tenantId</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>
                <span>tenantId</span> <span>=</span> <span>product</span><span>.</span><span>tenantId</span><span>();</span>
            <span>}</span>
            <span>productsMap</span><span>.</span><span>put</span><span>(</span><span>this</span><span>.</span><span>idOf</span><span>(</span><span>product</span><span>),</span> <span>each</span><span>);</span>
        <span>}</span>
        <span>this</span><span>.</span><span>cache</span><span>(</span><span>tenantId</span><span>).</span><span>putAll</span><span>(</span><span>productsMap</span><span>);</span>
    <span>}</span>

    <span>private</span> <span>String</span> <span>idOf</span><span>(</span><span>Product</span> <span>product</span><span>)</span> <span>{</span>
        <span>return</span> <span>this</span><span>.</span><span>idOf</span><span>(</span><span>product</span><span>.</span><span>productId</span><span>());</span>
    <span>}</span>
    <span>private</span> <span>String</span> <span>idOf</span><span>(</span><span>ProductId</span> <span>productId</span><span>)</span> <span>{</span>
        <span>return</span> <span>productId</span><span>.</span><span>id</span><span>();</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>remove</span><span>(</span><span>Product</span> <span>product</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>cache</span><span>(</span><span>product</span><span>.</span><span>tenantId</span><span>()).</span><span>remove</span><span>(</span><span>this</span><span>.</span><span>idOf</span><span>(</span><span>product</span><span>));</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>removeAll</span><span>(</span><span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>products</span><span>)</span> <span>{</span>
        <span>for</span> <span>(</span><span>Product</span> <span>each</span> <span>:</span> <span>products</span><span>)</span> <span>{</span>
            <span>this</span><span>.</span><span>remove</span><span>(</span><span>product</span><span>);</span>
        <span>}</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>allProductsOfTenant</span><span>(</span><span>Tenant</span> <span>tenant</span><span>)</span> <span>{</span>
        <span>Set</span><span>&lt;</span><span>Map</span><span>.</span><span>Entry</span><span>&lt;</span><span>String</span><span>,</span> <span>Product</span><span>&gt;&gt;</span> <span>entries</span> <span>=</span> 
            <span>this</span><span>.</span><span>cache</span><span>(</span><span>tenant</span><span>).</span><span>entrySet</span><span>();</span>
        <span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>products</span> <span>=</span> 
            <span>new</span> <span>HashSet</span><span>&lt;</span><span>Product</span><span>&gt;(</span><span>entries</span><span>.</span><span>size</span><span>());</span>
        <span>for</span> <span>(</span><span>Map</span><span>.</span><span>Entry</span><span>&lt;</span><span>String</span><span>,</span> <span>Product</span><span>&gt;</span> <span>entry</span> <span>:</span> <span>entries</span><span>)</span> <span>{</span>
            <span>products</span><span>.</span><span>add</span><span>(</span><span>entry</span><span>.</span><span>getValue</span><span>());</span>
        <span>}</span>
        <span>return</span> <span>products</span><span>;</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>Product</span> <span>productOfId</span><span>(</span><span>Tenant</span> <span>tenant</span><span>,</span> <span>ProductId</span> <span>productId</span><span>)</span> <span>{</span>
        <span>return</span> <span>(</span><span>Product</span><span>)</span> <span>this</span><span>.</span><span>cache</span><span>(</span><span>tenant</span><span>).</span><span>get</span><span>(</span><span>this</span><span>.</span><span>idOf</span><span>(</span><span>productId</span><span>));</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

몽고DB 구현

<ol>
  <li>애그리게잇을 -&gt; 몽고DB포맷(직렬화), 몽고DB포맷 -&gt; 애그리게잇(역직렬화)</li>
  <li>몽고DB 문서의 고유 식별자(_id)</li>
  <li>몽고DB 노드/클러스터 참조</li>
</ol>

<div><div><pre><span>class</span> <span>MongoProductRepository</span> 
        <span>extends</span> <span>MongoRepository</span><span>&lt;</span><span>Product</span><span>&gt;</span>
        <span>implements</span> <span>ProductRepository</span> <span>{</span>
    
    <span>public</span> <span>MongoProductRepository</span><span>()</span> <span>{</span>
        <span>super</span><span>();</span>
        <span>this</span><span>.</span><span>serializer</span><span>(</span><span>new</span> <span>BSONSerializer</span><span>&lt;</span><span>Product</span><span>&gt;(</span><span>Product</span><span>.</span><span>class</span><span>));</span>
    <span>}</span>

    <span>public</span> <span>ProductId</span> <span>nextIdentity</span><span>()</span> <span>{</span>
        <span>// 몽고DB에서 제공하는 식별자. _id 필드에 매핑시킬수 있음</span>
        <span>return</span> <span>new</span> <span>ProductId</span><span>(</span><span>new</span> <span>ObjectId</span><span>().</span><span>toString</span><span>());</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>save</span><span>(</span><span>Product</span> <span>product</span><span>)</span> <span>{</span>
        <span>this</span><span>.</span><span>databaseCollection</span><span>(</span>
                <span>this</span><span>.</span><span>collectionName</span><span>(</span><span>product</span><span>.</span><span>tenantId</span><span>()))</span>
            <span>.</span><span>save</span><span>(</span><span>this</span><span>.</span><span>serialize</span><span>(</span><span>product</span><span>));</span>
    <span>}</span>

    <span>protected</span> <span>String</span> <span>collectionName</span><span>(</span><span>TenantId</span> <span>tenantId</span><span>)</span> <span>{</span>
        <span>return</span> <span>"product"</span> <span>+</span> <span>tenantId</span><span>.</span><span>id</span><span>();</span>
    <span>}</span>

    <span>protected</span> <span>String</span> <span>databaseName</span><span>()</span> <span>{</span>
        <span>return</span> <span>"agilepm"</span><span>;</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>allProductsOfTenant</span><span>(</span>
            <span>TenantId</span> <span>tenantId</span><span>)</span> <span>{</span>
        <span>Collection</span><span>&lt;</span><span>Product</span><span>&gt;</span> <span>products</span> <span>=</span> <span>new</span> <span>ArrayList</span><span>&lt;&gt;();</span>
        <span>DBCursor</span> <span>cursor</span> <span>=</span> 
            <span>this</span><span>.</span><span>databaseCollection</span><span>(</span>
                <span>this</span><span>.</span><span>databaseName</span><span>(),</span>
                <span>this</span><span>.</span><span>collectionName</span><span>(</span><span>tenantId</span><span>)).</span><span>find</span><span>();</span>
        <span>while</span> <span>(</span><span>curosr</span><span>.</span><span>hasNext</span><span>())</span> <span>{</span>
            <span>DBObject</span> <span>dbObject</span> <span>=</span> <span>cursor</span><span>.</span><span>next</span><span>();</span>
            <span>Product</span> <span>product</span> <span>=</span> <span>this</span><span>.</span><span>deserialize</span><span>(</span><span>dbObject</span><span>);</span>
            <span>products</span><span>.</span><span>add</span><span>(</span><span>product</span><span>);</span>
        <span>}</span>
        <span>return</span> <span>products</span><span>;</span>
    <span>}</span>

    <span>@Override</span>
    <span>public</span> <span>Product</span> <span>productOfId</span><span>(</span>
            <span>TenantId</span> <span>tenantId</span><span>,</span> <span>ProductId</span> <span>productId</span><span>)</span> <span>{</span>
        <span>Product</span> <span>product</span> <span>=</span> <span>null</span><span>;</span>
        <span>BasicDBObject</span> <span>query</span> <span>=</span> <span>new</span> <span>BasicDBObject</span><span>();</span>
        <span>query</span><span>.</span><span>put</span><span>(</span><span>"producetId"</span><span>,</span> 
            <span>new</span> <span>BasicDBObject</span><span>(</span><span>"id"</span><span>,</span> <span>productId</span><span>.</span><span>id</span><span>()));</span>
        <span>DBCursor</span> <span>cursor</span> <span>=</span> 
            <span>this</span><span>.</span><span>databaseCollection</span><span>(</span>
                <span>this</span><span>.</span><span>databaseName</span><span>(),</span>
                <span>this</span><span>.</span><span>collectionName</span><span>(</span><span>tenantId</span><span>)).</span><span>find</span><span>(</span><span>query</span><span>);</span>
        <span>if</span> <span>(</span><span>cursor</span><span>.</span><span>hasNext</span><span>())</span> <span>{</span>
            <span>product</span> <span>=</span> <span>this</span><span>.</span><span>deserialize</span><span>(</span><span>cursor</span><span>.</span><span>next</span><span>());</span>
        <span>}</span>
        <span>return</span> <span>product</span><span>;</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<div><div><pre><span>class</span> <span>BSONSerializer</span><span>&lt;</span><span>T</span><span>&gt;</span> <span>{</span>
    <span>DBObject</span> <span>serialize</span><span>(</span><span>String</span> <span>key</span><span>,</span> <span>T</span> <span>object</span><span>)</span> <span>{</span>
        <span>DBObject</span> <span>serialization</span> <span>=</span> <span>this</span><span>.</span><span>serialize</span><span>(</span><span>object</span><span>);</span>
        <span>serialization</span><span>.</span><span>put</span><span>(</span><span>"_id"</span><span>,</span> <span>new</span> <span>ObjectId</span><span>(</span><span>key</span><span>));</span>
        <span>return</span> <span>serialization</span><span>;</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<div><div><pre><span>abstract</span> <span>class</span> <span>MongoRepository</span><span>&lt;</span><span>T</span><span>&gt;</span> <span>{</span>

    <span>protected</span> <span>DBCollection</span> <span>databaseCollection</span><span>(</span>
            <span>String</span> <span>databaseName</span><span>,</span> <span>String</span> <span>collectionName</span><span>)</span> <span>{</span>
        <span>return</span> <span>MongoDatabaseProvider</span>
                <span>.</span><span>database</span><span>(</span><span>databaseName</span><span>)</span>
                <span>.</span><span>getCollection</span><span>(</span><span>collectionName</span><span>);</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>
BSONSerializer 때문에 Setter를 제공할 필요가 없음</li>
</ul>

추가적인 행동

<ul>
  <li>예를 들면 count() or size()
</li>
  <li>또는 리파지토리에서 애그리게잇 파트를 쿼리하는 것 (성능상 잇점)
    <ul>
      <li>하지만 이건 안티패턴이기 때문에 가능한 사용하지 않는 것이 좋다 (애그리게잇 법칙 위배)</li>
      <li>만약 그게 당연시 하다고 느껴지면 애그리게잇을 분리하는 것도 한 방법</li>
    </ul>
  </li>
  <li>일반적으로 도메인 서비스 제어하가 어울린다.</li>
</ul>

<p>하지만 너무 유스케이스에 최적화된 조회 메서드를 많이 제공한다면 악취일 수도 있다</p>

<ul>
  <li>그런 경우 <strong>CQRS</strong>를 고려해보자</li>
</ul>

트랜잭션의 관리

<p>트랜잭션 관리는 애플리케이션 계층의 책임이다. = 애플리케이션 서비스</p>

<p><em>트랜잭션 관리 방법</em></p>

<div><div><pre><span>class</span> <span>ApplicationServiceFacade</span> <span>{</span>
    <span>// 명식적인 트랜잭션</span>
    <span>public</span> <span>void</span> <span>doSomeUseCaseTask1</span><span>()</span> <span>{</span>
        <span>Transaction</span> <span>transaction</span> <span>=</span> <span>null</span><span>;</span>
        <span>try</span> <span>{</span>
            <span>transaction</span> <span>=</span> <span>this</span><span>.</span><span>session</span><span>().</span><span>beginTransaction</span><span>();</span>
            <span>// 도메인 모델을 사용한다.</span>
            <span>transaction</span><span>.</span><span>commit</span><span>();</span>
        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> <span>e</span><span>)</span> <span>{</span>
            <span>if</span> <span>(</span><span>transaction</span> <span>!</span> <span>null</span><span>)</span> <span>{</span>
                <span>transaction</span><span>.</span><span>rollback</span><span>();</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>

    <span>// 선언적인 트랜잭션</span>
    <span>@Transactional</span>
    <span>public</span> <span>void</span> <span>doSomeUseCaseTask2</span><span>()</span> <span>{</span>
        <span>// 도메인 모델을 사용한다.</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>선언적인 방식이 더 낫다. 순수하게 도메인 로직에 위임하는 것에 집중할 수 있다.
    <ul>
      <li>관심사 분리!!</li>
    </ul>
  </li>
</ul>

경고

<p>단일 트랜잭션에서 여러 애그리게잇을 수정을 커밋하는 기능을 과도하게 사용하지 않도록 주의하라.</p>

타입 계층구조

<p><img src="http://www.plantuml.com/plantuml/svg/SoWkIImgAStDuKhEIImkLWXEBIhBJ4uDACeloqn9BLAevb9GAAaiIEMgXIe8JonAoab5LvPQKPAQbuAX7QOdFo-RU3qEG56WWm00" alt="Type Hierarchy"></p>

<div><div><pre><span>// 도메인 모델의 클라이언트</span>
<span>serviceProviderRepository</span><span>.</span><span>providerOf</span><span>(</span><span>id</span><span>)</span>
        <span>.</span><span>scheduleService</span><span>(</span><span>date</span><span>,</span> <span>description</span><span>);</span>
</pre></div></div>

<ul>
  <li>상위 타입(ServiceProvider)으로 처리</li>
</ul>

<div><div><pre><span>// 도메인 모델의 클라이언트</span>
<span>if</span> <span>(</span><span>id</span><span>.</span><span>identifiesWarble</span><span>())</span> <span>{</span>
    <span>serviceProviderRepository</span><span>.</span><span>warbleOf</span><span>(</span><span>id</span><span>)</span>
            <span>.</span><span>scheduleWarbleService</span><span>(</span><span>date</span><span>,</span> <span>warbleDescription</span><span>);</span>
<span>}</span> <span>else</span> <span>if</span> <span>(</span><span>id</span><span>.</span><span>identifiesWonkle</span><span>())</span> <span>{</span>
    <span>serviceProviderRepository</span><span>.</span><span>wonkleOf</span><span>(</span><span>id</span><span>)</span>
            <span>.</span><span>scheduleWonkleService</span><span>(</span><span>date</span><span>,</span> <span>wonkleDescription</span><span>);</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>하위 타입을 클라이언트에서 알고 분기 처리 해야하는 책임이 늘어난다.</li>
  <li>위 코드는 전형적인 악취이다.</li>
</ul>

<p><strong>그러므로 상위타입은 하위타입에 대한 구분정보(type 속성)를 알고 있어야 한다.</strong></p>

<ul>
  <li>그렇게 된다면 Repository 계층에서 캡슐화 시켜서 하위 타입 별 분기 처리를 할 수 있을 것이다.</li>
</ul>

<div><div><pre><span>@Entity</span>
<span>class</span> <span>ServiceProvider</span> <span>{</span>
    <span>...</span>
    <span>private</span> <span>ServiceType</span> <span>type</span><span>;</span>

    <span>public</span> <span>void</span> <span>scheduleService</span><span>(</span><span>Date</span> <span>date</span><span>,</span> <span>ServiceDescription</span> <span>description</span><span>)</span> <span>{</span>
        <span>if</span> <span>(</span><span>type</span><span>.</span><span>isWarble</span><span>())</span> <span>{</span>
            <span>this</span><span>.</span><span>scheduleWarbleSevice</span><span>(</span><span>date</span><span>,</span> <span>description</span><span>);</span>
        <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>type</span><span>.</span><span>isWonkle</span><span>())</span> <span>{</span>
            <span>this</span><span>.</span><span>scheduleWonkleService</span><span>(</span><span>date</span><span>,</span> <span>description</span><span>);</span>
        <span>}</span> <span>else</span> <span>{</span>
            <span>this</span><span>.</span><span>scheduleCommonService</span><span>(</span><span>date</span><span>,</span> <span>description</span><span>);</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>나라면 위의 경우에서도 ServiceType으로 위임해서 if문을 제거했을 것 같다.</li>
</ul>

리파지토리 대 데이터 액세스 객체

<p>Repository != DAO</p>

<ul>
  <li>리파지토리 : 객체 지향 &gt; with 도메인 모델 패턴</li>
  <li>DAO : 데이터 지향 &gt; with 트랜잭션 스크립트 패턴</li>
</ul>

<p>SMART DAO는 DDD 입장에서는 안티패턴</p>

<ul>
  <li>SMART DAO는 도메인 로직이 DB 쿼리나 DB의 프로시저에 존재하는 경우를 말함</li>
</ul>

<p><strong>중요한 것은 데이터 액세스 지향보다는 컬렉션 지향으로 설계하려고 노력해야하는 점</strong></p>

리파지토리의 테스트

<ul>
  <li>실제 인프라와 연동하는 테스트 (실제 DB와 통신)</li>
  <li>인메모리로 연동하는 테스트</li>
</ul>

<blockquote>
  <p>개인적으로 실제 인프라와 연동하는 것이 중요하다고 봄.</p>
</blockquote>

인메모리 구현으로 테스트하기

<p>Skip</p>

마무리

<ul>
  <li>컬랙션 지향 VS 영속성 지향</li>
  <li>리파지토리의 추가적인 행동 (count())</li>
  <li>트랜잭션 처리</li>
  <li>타입 계층과 리파지토리</li>
  <li>Repository vs DAO</li>
  <li>테스트</li>
</ul>

    <p><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvtzOkwB8cVmXGClSUdbrej3V-2F8tyT8YzlsGR48HkVBDGQ-3D-3DUStA_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXvwW4pdWHXONtD5tHoCXDUmj1qJCikhDwd8NNdKKxbaMiHjV-2Bfh4Ii1zv3np3sSiJzi8zN3GKN3pg-2FT4p01-2F3WSZeNHq8xjKgLqCtmZkV795eKX0Pem6ISKZ0UIQa4cBl6GzoQAoK8hue3qgtJLzpOPklGiFMo3a-2BXLbKcQPxAQWwH66a0PS0IQULKMADJaOP4nEt7I3Z6cy42OlUFS2AMt">IDDD 12장. 리파지토리</a> was originally published by MJ at <a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvvsNBNYnRXmInA7E20V1hcUmGGG_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXvwW4pdWHXONtD5tHoCXDUmj1qJCikhDwd8NNdKKxbaMiKlCIsncf6KjasP2SJrGbmVrSv2C-2B3pShsA98Cm-2Bo-2FpZxF3iCA0fCJfD-2Fa-2B-2BADKlcfKqPn3ehIwi6kfm8UYQgyLyJFwo-2BFXBG-2FnuJ6ERbElONGT-2BnDBDMXXTzccFnlk11V0JKuwjDYpyzFjL-2BGgq-2F5FYJDTWRWvWDPy9bOoWcCs">DevOOOOOOOOP</a> on June 10, 2018.</p>
  
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMPh1EwBFJtaMpKlkf5Qk9n1hTYSIrEZy321pHofeJ-2F9wq0-2BxstCKFfJqwwiWyKAcSIr9KzqcKwn-2F0RwshFaorWVNHJ4PnJrATMFJ-2BTpxGxSFqo6PFqWmoMjgqg59RWGVrGhRN81G-2FzKQlVmSILJn3atshNAEOwrb3TmOf3h7B3xt71tD2Pb3lAgCH7DvBBjgZ8R1ircHmyxMuD7JU-2F51lF8" alt="" width="1" height="1" />


  </div>
  <div class="entry-more-link">
    <a href="https://weblog.youre.space/imyaman/2020/05/003905.html" itemprop="url">Continue reading</a>
  </div>
</article>


              
            </div>
            <aside class="widgets related" role="complementary">
              <nav class="widget-search widget">
  <div class="widget-content">
    <form method="get" id="search" action="https://connexus.youre.space/mt6/mt-search.cgi">
      <div>
        <input type="text" name="search" value="" placeholder="Search...">

        <input type="hidden" name="IncludeBlogs" value="1">

        <input type="hidden" name="limit" value="20">
        <button type="submit" name="button">
          <img alt="Search" src="https://connexus.youre.space/mt-static/support/theme_static/rainier/img/search-icon.png">
        </button>
      </div>
    </form>
  </div>
</nav>
<nav class="widget-archive-dropdown widget">
  <h3 class="widget-header">Archives</h3>
  <div class="widget-content">
    <select>
      <option>Select a Month...</option>
    
      <option value="https://weblog.youre.space/2002/07/">July 2002</option>
    
    </select>
  </div>
</nav>
    
  

<div class="widget-syndication widget section">
  <div class="widget-content">
    <p><img src="https://connexus.youre.space/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="https://weblog.youre.space/atom.xml">Subscribe to this blog's feed</a></p>

  </div>
</div>

            </aside>
          </div>
        </div>
        <footer id="footer" role="contentinfo">
          <div id="footer-inner">
            <div id="footer-content">
  <nav role="navigation">
          <ul>
            <li><a href="https://weblog.youre.space/">Home</a></li>


          </ul>
        </nav>

  <p class="license">&copy; Copyright 2020.</p>
  <p class="poweredby">Powered by <a href="http://www.movabletype.org/">Movable Type</a> and <a href="http://youre.space/">youre.space</a></p>
</div>

<!-- ad starts -->
<center>
<div class="main_banner" id="main_banner1">
  <script type="text/javascript"> var tad_conf = { targetId : 'main_banner1', clientId : 'MX00048A1', slotNo : 2 }; </script>
  <script type="text/javascript" src="http://adddn.adotsolution.com/contents/sdk/js/tad.min.js"></script>
</div>
</center>

<center>
<div id="realssp_imyaman00001_7916" class="realssp_dv" data-mcode="aW15YW1hbjAwMDAxXzc5MTY="></div>
<script src="//nw.realssp.co.kr/realclickssp.js?v=1.0&m=imyaman00001_7916&t=j" async></script>
</center>

<center>
<div id="admixer_display"></div>
</center>
<script type="text/javascript" src="//scr.nsmartad.com/admixer/admixer.js"></script>
<script type="text/javascript">
    new admixer_ad({
    admixer_key:"zp1v4th5",
    display_id:"admixer_display",
    adsense_publisher_key:"ca-mb-pub-0000000000000000", //AdSense 사용시에만 필요
    ad_change:true,  //default : true
    test : false,//default : false
    test_display_id : "log"
});
</script>
<!-- ad ends -->
          </div>
        </footer>
      </div>
    </div>
    <script src="https://connexus.youre.space/mt-static/jquery/jquery.min.js"></script>
    <script src="https://weblog.youre.space/mt-theme-scale2.js"></script>

<!-- ad starts -->                                                                 <center>
  <div id="admixer_display"></div>
</center>
<script type="text/javascript" src="//scr.nsmartad.com/admixer/admixer.js"></script>
<script type="text/javascript">
new admixer_ad({
  admixer_key:"zp1v4th5",
  display_id:"admixer_display",
  adsense_publisher_key:"ca-mb-pub-0000000000000000", //AdSense 사용시에만 필요
  ad_change:true,  //default : true
  test : false,//default : false
  test_display_id : "log"
});
</script>
<!-- ad ends -->

</body>
</html>
