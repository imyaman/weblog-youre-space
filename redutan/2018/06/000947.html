<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="애그리게잇을 생성하는 책임을 가지는 메소드나 객체를 말한다. 애그리게잇 생성을 캡슐화 도메인 모댈 내의 팩토리 복잡한 객체와 애그리게잇 인스턴스를 생성하는 책임을 별도의 객체로 이동시키자. 여기서의 책임은 도메인 모델과 관련이 있지 않지만, 여전히 도메인 설계를 구성하는 한 요소 다. 모든 복잡한 조립...">
    <meta name="generator" content="Movable Type 6.3.6">
    <title>IDDD 111장. 팩토리 - redutan</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://weblog.youre.space/redutan/styles.css">
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="https://weblog.youre.space/redutan/styles_ie.css">
    <script src="https://connexus.youre.space/mt-static/support/theme_static/rainier/js/html5shiv.js"></script>
    <![endif]-->
    
    <link rel="start" href="https://weblog.youre.space/redutan/">
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="https://weblog.youre.space/redutan/atom.xml" />
    <link rel="canonical" href="https://weblog.youre.space/redutan/2018/06/000947.html" />
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-102177098-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <link rel="prev" href="https://weblog.youre.space/redutan/2018/06/000940.html" title="IDDD 10장. 애그리게잇">
    <link rel="next" href="https://weblog.youre.space/redutan/2018/07/000963.html" title="IDDD 12장. 리파지토리">
    <!-- Open Graph Protocol -->
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-us">
    <meta property="og:title" content="IDDD 111장. 팩토리">
    <meta property="og:url" content="https://weblog.youre.space/redutan/2018/06/000947.html">
    <meta property="og:description" content="애그리게잇을 생성하는 책임을 가지는 메소드나 객체를 말한다. 애그리게잇 생성을 캡슐화 도메인 모댈 내의 팩토리 복잡한 객체와 애그리게잇 인스턴스를 생성하는 책임을 별도의 객체로 이동시키자. 여기서의 책임은 도메인 모델과 관련이 있지 않지만, 여전히 도메인 설계를 구성하는 한 요소 다. 모든 복잡한 조립...">
    <meta property="og:site_name" content="redutan">
    <meta property="og:image" content="https://connexus.youre.space/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    <!-- Metadata -->
    <meta itemprop="description" content="애그리게잇을 생성하는 책임을 가지는 메소드나 객체를 말한다. 애그리게잇 생성을 캡슐화 도메인 모댈 내의 팩토리 복잡한 객체와 애그리게잇 인스턴스를 생성하는 책임을 별도의 객체로 이동시키자. 여기서의 책임은 도메인 모델과 관련이 있지 않지만, 여전히 도메인 설계를 구성하는 한 요소 다. 모든 복잡한 조립...">
    <link itemprop="url" href="https://weblog.youre.space/redutan/2018/06/000947.html">
    <link itemprop="image" href="https://connexus.youre.space/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    
  </head>
  <body>
    <div id="container">
      <div id="container-inner">
        <header id="header" role="banner">
          <div id="header-inner">
            <div id="header-content">
              <h1>
                <a href="https://weblog.youre.space/redutan/">

                  redutan

                </a>
              </h1>
              
            </div>

            <nav role="navigation">
          <ul>
            <li><a href="https://weblog.youre.space/redutan/">Home</a></li>


          </ul>
        </nav>

          </div>
        </header>
        <div id="content">
          <div id="content-inner">
            <ul class="breadcrumb breadcrumb-list">
              <li class="breadcrumb-list-item"><a href="https://weblog.youre.space/redutan/">Home</a></li>
              <li class="breadcrumb-list-item">IDDD 111장. 팩토리</li>
            </ul>
            <div id="individual-main" class="main" role="main">
              <article id="entry-947" class="entry entry-asset asset hentry">
                <div class="asset-header">
                  <h2 itemprop="name" class="asset-name entry-title">IDDD 111장. 팩토리</h2>
                  <footer class="asset-meta">
                    <ul class="asset-meta-list">
                      <li class="asset-meta-list-item">Posted on <time datetime="2018-06-07T12:16:00+09:00" itemprop="datePublished">June  7, 2018</time></li>
                      <li class="asset-meta-list-item">by <span class="author entry-author vcard"><a class="fn url" href="http://weblog.youre.space/vergence/">Sangyong Gwak</a></span></li>

  

                   </ul>
                </footer>
                </div>
                <div class="entry-content asset-content" itemprop="articleBody">
                  <p>애그리게잇을 생성하는 책임을 가지는 메소드나 객체를 말한다.</p>

<p>애그리게잇 생성을 캡슐화</p>

<p>도메인 모댈 내의 팩토리</p>

<p>복잡한 객체와 애그리게잇 인스턴스를 생성하는 책임을 별도의 객체로 이동시키자. 여기서의 책임은 도메인 모델과 관련이 있지 않지만, 여전히 도메인 설계를 구성하는 한 요소 다. 모든 복잡한 조립 과정을 캡슐화하고, 클라이언트가 인스턴스화된 객체의 구체적 클래스를 참조할 필요가 없도록 인터페이스를 제공하자. 전체 애그리게잇을 하나의 조각(원자성)으로 생성하고 고정자(Invariant)를 지정하자 [Evans]</p>

<p>팩토리 메소드 : 이 책은 주로 여기만 나옴</p>

<p>팩토리 객체(클래스)</p>

<p>애그리게잇 생성이 매우 복잡하고 다른 객체의 도움이 필요하면 클래스 분리를 하는 것이 좋은 것 같다.</p>

<p>가능한 팩토리 위치</p>

<p>애그리게잇 루트</p>

<p>정정 생성자를 통해서 도메인 의도가 나오면 더 좋다. static Task#forDraft()</p>

<p>아니면 상위 루트에서 하위 엔터리 생성도 가능 Project#createTask()</p>

<p>도메인 서비스 : 서비스 기반 팩토리</p>

<p>ProjectService#createProject()</p>

<p>팩토리 : 이 책은 다루지 않음</p>

<p>ProjectFactory#create()</p>

<p>애그리게잇 루트상의 팩토리 메소드</p>

<p>바운디드 컨텍스트</p>

<p>애그리게잇</p>

<p>팩토리 메소드</p>

<p>식별자와 액세스 컨텍스트</p>

<p>Tenant</p>

<p>offerRegisterationInvitation()</p>

<p>provisionGroup()</p>

<p>provisionRole()</p>

<p>registerUser()</p>

<p>협업 컨텍스트</p>

<p>Calendar</p>

<p>scheduleCalendarEntry()</p>

<p>Forun</p>

<p>startDiscussion()</p>

<p>Discussion</p>

<p>post()</p>

<p>애자일 PM 컨텍스트</p>

<p>Product</p>

<p>planBacklogItem()</p>

<p>scheduleRelease()</p>

<p>scheduleSprint()</p>

<p>CalendarEntry 인스턴스 생성하기</p>

<p>@Entity</p>

<p>class Calendar extends AbstractAggregateRoot {</p>

<p>CalendarEntry scheduleCalendarEntry (...) {</p>

<p>CalendarEntry calendarEntry = new CalendarEntry (...);</p>

<p>this . registerEvent ( new CalendarEntryScheduled (...));</p>

<p>return calendarEntry ;</p>

<p>}</p>

<p>}</p>

<p>유비쿼터스 언어에 부합되는 도메인이 표현됨 : scheduleCalendarEntry</p>

<p>보호절이 없다 : 어짜피 new CalendarEntry(...) 가 책임짐</p>

<p>Setter 를 사용하지 않는다. > 원자성 + 부수효과 줄어듬 + 불변식 강제 가 쉬움</p>

<p>이벤트 발행 : CalendarEntryScheduled</p>

<p>인자의 갯수가 줄어든다.</p>

<p>scheduleCalendarEntry(...) 에서는 11개가 요구되지만, new CalendarEntryScheduled(...) 에서는 9개로 줄어든다.</p>

<p>개인적으로는 이것도 인자를 캡슐화 시켜서 객체로 말아버리는 것이 좋은 것 같다. 9개의 인자라도 너무 많은 것 같음.</p>

<p>하지만</p>

<p>CalendarEntry 를 생성하기 위해서는 꼭 Calendar 인스턴스 가 요구됨</p>

<p>이는 DB 조회라는 부하가 추가됨</p>

<p>Discussion 인스턴스 생성하기</p>

<p>@Entity</p>

<p>class Forum extends AbstractAggregateRoot {</p>

<p>Discussion startDiscussion (</p>

<p>DiscussionId discussionId ,</p>

<p>Author author ,</p>

<p>String subject ) {</p>

<p>if ( this . isClosed ()) {</p>

<p>throw new IllegalStateException ( "Forum is closed" );</p>

<p>}</p>

<p>Discussion discussion = new Discussion (</p>

<p>this . tenant (),</p>

<p>this . forumId (),</p>

<p>discussionId ,</p>

<p>author ,</p>

<p>subject );</p>

<p>registerEvent ( new DiscussionStarted (...));</p>

<p>return discussion ;</p>

<p>}</p>

<p>}</p>

<p>포럼이 열린 경우에만 토론을 시작할 수 있다. : this.isClosed()</p>

<p>인자 5개 중 3개만 있으면 된다. : 나머지 2개는 포럼에서 제공</p>

<p>역시나 유비쿼터스 언어가 표현된다. : startDiscussion</p>

<p>서비스의 팩토리</p>

<p>package com . saasovation . collaboration . domain . model . collaborator ;</p>

<p>interface CollaboratorSerice {</p>

<p>Author authorFrom ( Tenant tenant , String identity );</p>

<p>Creator creatorFrom ( Tenant tenant , String identity );</p>

<p>Moderator moderatorFrom ( Tenant tenant , String identity );</p>

<p>Owner ownerFrom ( Tenant tenant , String identity );</p>

<p>Participant participantFrom ( Tenant tenant , String identity );</p>

<p>}</p>

<p>// infrastructure.services !!!</p>

<p>package com . saasovation . collaboration . infrastructure . services ;</p>

<p>class UserRoleToCollaborationService implements CollaboratorSerice {</p>

<p>@Override</p>

<p>public Author authorFrom ( Tenant tenant , String identity ) {</p>

<p>return ( Author ) userInRoleAdapter . toCollaborator (</p>

<p>tenant , identity , "Author" , Author . class );</p>

<p>)</p>

<p>}</p>

<p>}</p>

<p>package com . saasovation . collaboration . domain . model . collaborator ;</p>

<p>class Author extends Collaborator {</p>

<p>...</p>

<p>}</p>

<p>기술적 구현이므로 인프라 계층 의 모듈에 위치한다.</p>

<p>어댑터에 의존한다.</p>

<p>UserInRoleAdapter 는 외래 컨텍스트와 의사소통 책임만 갖는다.</p>

<p>CollaboratorTranslator 는 바운디드 컨텍스트 내 도메인 객체로 변환 책임만 갖는다.</p>

<p>협업에서는 identity 식별자와 액세스에서는 username</p>

<p>마무리</p>

<p>유비쿼터스 언어로 애그리게잇을 생성</p>

<p>애그리게잇의 팩토리 메서드 VS 서비스의 팩토리 메서드</p>

<p>IDDD 111장. 팩토리 was originally published by MJ at DevOOOOOOOOP on June 07, 2018.</p>

<p>source : http://redutan.github.io/2018/06/07/IDDD-chapter11</p>

<p>---------------------------------------------------------------------------<br />Visit this link to stop these emails: http://zpr.io/nXidW</p>

                  
                </div>
                <nav class="page-navigation entry-navigation pagination content-nav">
                  <ul class="page-navigation-list">

                    <li class="page-navigation-list-item page-navigation-prev"><a rel="prev" href="https://weblog.youre.space/redutan/2018/06/000940.html" title="IDDD 10장. 애그리게잇">Previous entry</a></li>


                    <li class="page-navigation-list-item page-navigation-next"><a rel="next" href="https://weblog.youre.space/redutan/2018/07/000963.html" title="IDDD 12장. 리파지토리">Next entry</a></li>

                  </ul>
                </nav>
                <!--
<aside id="zenback" class="zenback feedback">
  
    Please paste Zenback script code here.
  
</aside>
-->
                
                <aside id="trackbacks" class="trackbacks feedback">
  <h2>TrackBacks</h2>
  
  <p id="trackback-url">TrackBack URL: https://connexus.youre.space/mt6/mt-tb.cgi/316</p>
  
  
</aside>


              </article>
            </div>
            <aside class="widgets related" role="complementary">
              <nav class="widget-search widget">
  <div class="widget-content">
    <form method="get" id="search" action="https://connexus.youre.space/mt6/mt-search.cgi">
      <div>
        <input type="text" name="search" value="" placeholder="Search...">

        <input type="hidden" name="IncludeBlogs" value="17">

        <input type="hidden" name="limit" value="20">
        <button type="submit" name="button">
          <img alt="Search" src="https://connexus.youre.space/mt-static/support/theme_static/rainier/img/search-icon.png">
        </button>
      </div>
    </form>
  </div>
</nav>
<nav class="widget-archive-dropdown widget">
  <h3 class="widget-header">Archives</h3>
  <div class="widget-content">
    <select>
      <option>Select a Month...</option>
    
      <option value="https://weblog.youre.space/redutan/2018/07/">July 2018</option>
    
  
    
      <option value="https://weblog.youre.space/redutan/2018/06/">June 2018</option>
    
  
    
      <option value="https://weblog.youre.space/redutan/2018/05/">May 2018</option>
    
  
    
      <option value="https://weblog.youre.space/redutan/2018/04/">April 2018</option>
    
  
    
      <option value="https://weblog.youre.space/redutan/2018/02/">February 2018</option>
    
    </select>
  </div>
</nav>
    
  

<div class="widget-syndication widget section">
  <div class="widget-content">
    <p><img src="https://connexus.youre.space/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="https://weblog.youre.space/redutan/atom.xml">Subscribe to this blog's feed</a></p>

  </div>
</div>

            </aside>
          </div>
        </div>
        <footer id="footer" role="contentinfo">
          <div id="footer-inner">
            <div id="footer-content">
  <nav role="navigation">
          <ul>
            <li><a href="https://weblog.youre.space/redutan/">Home</a></li>


          </ul>
        </nav>

  <p class="license">&copy; Copyright 2019.</p>
  <p class="poweredby">Powered by <a href="http://www.movabletype.org/">Movable Type</a></p>
</div>
          </div>
        </footer>
      </div>
    </div>
    <script src="https://connexus.youre.space/mt-static/jquery/jquery.min.js"></script>
    <script src="https://weblog.youre.space/redutan/mt-theme-scale2.js"></script>
  </body>
</html>
