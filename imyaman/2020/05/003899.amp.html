<!doctype html>
<html ⚡ itemscope itemtype="http://schema.org/Article">
<head>   
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <link rel="canonical" href="https://weblog.youre.space/imyaman/2020/05/003899.html">
  <style amp-boilerplate>
body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}
</style>
<noscript>
<style amp-boilerplate>
body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}
</style>
</noscript>
<script async src="https://cdn.ampproject.org/v0.js"></script>
  <meta name="description" content=" 도메인 서비스 : 도메인 모델 내 무상태 오퍼레이션 제공 애그리게잇이나 값 객체의 행위로써 어울리지 않는 것 before class Product { Set&amp;lt;BacklogItem&amp;gt; backlogItems; BusinessPriorityTotals businessPriorityTotals() { //... } } 모델 정제를 통해 Set&amp;lt;BacklogItem&amp;gt; backlogItems를 분리 그렇다면 businessPriorityTotals() 메서드는 어떻게 되는가?...">
  <meta name="generator" content="Movable Type 6.3.6">
  <title>IDDD 7ì¥. ìë¹ì¤ - imyaman</title>

  <link rel="prev" href="https://weblog.youre.space/imyaman/2020/05/003898.amp.html" title="IDDD 6장. 값 객체">
  

    <!-- Open Graph Protocol -->
    <meta property="og:type" content="article">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:title" content="IDDD 7ì¥. ìë¹ì¤">
    <meta property="og:url" content="https://weblog.youre.space/imyaman/2020/05/003899.html">
    <meta property="og:description" content=" 도메인 서비스 : 도메인 모델 내 무상태 오퍼레이션 제공 애그리게잇이나 값 객체의 행위로써 어울리지 않는 것 before class Product { Set&amp;lt;BacklogItem&amp;gt; backlogItems; BusinessPriorityTotals businessPriorityTotals() { //... } } 모델 정제를 통해 Set&amp;lt;BacklogItem&amp;gt; backlogItems를 분리 그렇다면 businessPriorityTotals() 메서드는 어떻게 되는가?...">
    <meta property="og:site_name" content="imyaman">
    <meta property="og:image" content="/mt-static/support/theme_static/rainier/img/siteicon-sample.png">

    <!-- Metadata -->
    <meta itemprop="description" content=" 도메인 서비스 : 도메인 모델 내 무상태 오퍼레이션 제공 애그리게잇이나 값 객체의 행위로써 어울리지 않는 것 before class Product { Set&amp;lt;BacklogItem&amp;gt; backlogItems; BusinessPriorityTotals businessPriorityTotals() { //... } } 모델 정제를 통해 Set&amp;lt;BacklogItem&amp;gt; backlogItems를 분리 그렇다면 businessPriorityTotals() 메서드는 어떻게 되는가?...">
    <link itemprop="url" href="https://weblog.youre.space/imyaman/2020/05/003899.html">
    <link itemprop="image" href="/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    
  </head>
  <body itemscope itemtype="http://schema.org/Article">

<h1 itemprop="headline">IDDD 7ì¥. ìë¹ì¤</h1>
<time datetime="2020-05-11T01:25:20+09:00" itemprop="datePublished">May 11, 2020</time>
<time datetime="2020-05-11T01:25:20+09:00" itemprop="dateModified">May 11, 2020</time>

by <span itemprop="author">hal9000</span>

<div itemprop="articleBody">
  

  
    
  
  
      
    <p><strong>도메인 서비스</strong> : 도메인 모델 내 무상태 오퍼레이션 제공</p>

<ul>
  <li>애그리게잇이나 값 객체의 행위로써 어울리지 않는 것</li>
</ul>

<p><em>before</em></p>
<div><div><pre><span>class</span> <span>Product</span> <span>{</span>
    <span>Set</span><span>&lt;</span><span>BacklogItem</span><span>&gt;</span> <span>backlogItems</span><span>;</span>

    <span>BusinessPriorityTotals</span> <span>businessPriorityTotals</span><span>()</span> <span>{</span>
        <span>//...</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>모델 정제를 통해 Set&lt;BacklogItem&gt; backlogItems를 분리</li>
  <li>그렇다면 businessPriorityTotals() 메서드는 어떻게 되는가?</li>
</ul>

<p><em>after</em></p>
<div><div><pre><span>class</span> <span>Product</span> <span>{</span>
    <span>static</span> <span>BusinessPriorityTotals</span> <span>businessPriorityTotals</span><span>(</span>
            <span>Set</span><span>&lt;</span><span>BacklogItem</span><span>&gt;</span> <span>aBacklogItems</span><span>)</span> <span>{</span>
        <span>// ...</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

<ul>
  <li>정적 메소드로 변경 - 하지만 과연 이것은 옳은가?</li>
</ul>

<p><strong>도메인 서비스</strong> 가 필요한 시점이다!</p>

도메인 서비스란 무엇인가

<blockquote>
  <p>하지만 그보다 먼저 도메인 서비스가 아닌 것은 무엇인가?</p>
</blockquote>

<ul>
  <li>도메인 서비스 : 도메인 로직이 있다.</li>
  <li>애플리케이션 서비스 : 도메인 로직이 없다. (보안, 트랜잭션 등)</li>
</ul>

<p><em>정의</em></p>

<ul>
  <li>엔터티나 값객체의 책임이 아닌 (도메인적) 행위</li>
  <li>유비쿼터스 언어로써 표현</li>
  <li>무상태!</li>
</ul>

<p><em>예시</em></p>

<ul>
  <li>
<em>중요</em> 비즈니스 프로세스
    <ul>
      <li>
<em>복수 개</em>의 도메인 객체에서 필요로 하는 계산</li>
    </ul>
  </li>
  <li>한 조합에서 다른 조합으로 도메인 객체를 <em>변형</em>할 때</li>
</ul>

서비스가 필요할지 확인하자

<p>도메인 특화 지식은 클라이언트로 절대 유촐돼선 안된다.(클라이언트가 애플리케이션 서비스일지라도)
도메인 객체에 위치 시키기 애매하면 <em>도메인 서비스</em>에 담는다.</p>

<p>주의: 도메인 서비스를 남용하면 빈약한(Anemic) 도메인 모델이 된다.</p>

도메인에서 서비스를 모델링하기

<p><em>AuthenticationService</em></p>
<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>identityaccess</span><span>.</span><span>domain</span><span>.</span><span>model</span><span>.</span><span>identity</span><span>;</span>   <span>// !!</span>

<span>interface</span> <span>AuthenticationService</span> <span>{</span>
    <span>UserDescriptor</span> <span>authenticate</span><span>(</span>
        <span>TenantId</span> <span>tenantId</span><span>,</span>
        <span>String</span> <span>username</span><span>,</span>
        <span>Strin</span> <span>password</span><span>);</span>
<span>}</span>
</pre></div></div>

<p><em>EncryptionAuthenticationService</em></p>
<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>identityaccess</span><span>.</span><span>infra</span><span>.</span><span>services</span><span>;</span>   <span>// !!</span>

<span>class</span> <span>EncryptionAuthenticationService</span> <span>implements</span> <span>AuthenticationService</span> <span>{</span>
    <span>@Override</span>
    <span>UserDescriptor</span> <span>authenticate</span><span>(</span>
            <span>@NonNull</span> <span>TenantId</span> <span>tenantId</span><span>,</span>
            <span>@NonNull</span> <span>String</span> <span>username</span><span>,</span>
            <span>@NonNull</span> <span>Strin</span> <span>password</span><span>)</span> <span>{</span>

        <span>Tenant</span> <span>tenant</span> <span>=</span> <span>tenantRepository</span><span>.</span><span>findById</span><span>(</span><span>tenantId</span><span>);</span>
        <span>if</span> <span>(</span><span>tenant</span> <span>==</span> <span>null</span> <span>||</span> <span>!</span><span>tenant</span><span>.</span><span>isActive</span><span>())</span> <span>{</span>
            <span>throw</span> <span>new</span> <span>TenantNotFoundException</span><span>(</span><span>tenantId</span><span>);</span>
        <span>}</span>
        <span>String</span> <span>encryptedPassword</span> <span>=</span> 
                <span>encryptService</span><span>.</span><span>encryptedValue</span><span>(</span><span>passwod</span><span>);</span> <span>// 암호화 책임도 도메인 서비스?</span>
        <span>User</span> <span>user</span> <span>=</span> <span>userRepository</span><span>.</span><span>findByTenantAndUsernameAndPassword</span><span>(</span>
            <span>tenant</span><span>,</span> <span>username</span><span>,</span> <span>encryptedPassword</span><span>);</span>
        <span>if</span> <span>(</span><span>user</span> <span>==</span> <span>null</span> <span>||</span> <span>!</span><span>user</span><span>.</span><span>isEnabled</span><span>())</span> <span>{</span>
            <span>throw</span> <span>new</span> <span>UserNotFoundException</span><span>(</span><span>username</span><span>);</span>
        <span>}</span>
        <span>return</span> <span>user</span><span>.</span><span>userDescriptor</span><span>();</span>
    <span>}</span>
<span>}</span>
</pre></div></div>

분리된 인터페이스가 꼭 필요할까

<p>다형성이 요구되지 않는다면 굳이 분리된 인터페이스는 필요하지 않다고 본다.
다형성 등으로 인한 추상화가 요구될 때 분리된 인터페이스로 리팩토링 하자</p>

<p>생각 : 구현클래스에 Impl 접미사를 붙이는 것은 가능하면 피하는 것이 좋다고 본다.</p>

<p>DI 프레임워크(ex:Spring)를 사용하면 분리된 인터페이스를 사용하기 더 편하다.</p>

계산 프로세스

<p>생각: 계산(연산)은 변하지 않는 행동이므로 <em>분리된 인터페이스</em>는 필요하지 않다.</p>

<p>대부분 경우 계산 프로세스를 <strong>정적 메서드</strong>로 해결하는 경향이 많다.
이는 잘못된 행동이며 계산이 도메인 로직을 표현한다면 당연히 도메인 모델 내에 <strong>도메인 서비스로써 존재</strong>해야 한다.</p>

<p>참고: p.369 ~ 371 소스코드</p>

변환 서비스

<p>타 서비스와 통합을 위해 사용</p>
<ul>
  <li>이것도 <em>도메인 서비스</em>였다니</li>
</ul>

<p>Adapter</p>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>saasovation</span><span>.</span><span>collaboration</span><span>.</span><span>infra</span><span>.</span><span>services</span><span>;</span>

<span>class</span> <span>UserInRoleAdapter</span> <span>{</span>
    <span>&lt;</span><span>T</span> <span>extends</span> <span>Collaborator</span><span>&gt;</span> <span>T</span> <span>toCollaborator</span><span>(</span>
            <span>Tenant</span> <span>tenant</span><span>,</span> <span>String</span> <span>identity</span><span>,</span> <span>String</span> <span>role</span><span>,</span> 
            <span>Class</span><span>&lt;</span><span>T</span><span>&gt;</span> <span>collaboratorClass</span><span>);</span>
<span>}</span>
</pre></div></div>

<p>Translator</p>

<div><div><pre><span>package</span> <span>com</span><span>.</span><span>sasovation</span><span>.</span><span>collaboration</span><span>.</span><span>infra</span><span>.</span><span>services</span><span>;</span>

<span>class</span> <span>CollbaratorTransaltor</span> <span>{</span>
    <span>&lt;</span><span>T</span> <span>extends</span> <span>Collaborator</span><span>&gt;</span> <span>T</span> <span>toCollaboratorFrom</span><span>(</span>
            <span>String</span> <span>json</span><span>,</span> <span>Class</span><span>&lt;</span><span>T</span><span>&gt;</span> <span>collaboratorClass</span><span>);</span>
<span>}</span>
</pre></div></div>

<p>생각: translator도 도메인 서비스 인가?</p>

도메인 서비스의 미니 계층 사용하기

<p>가능하면 미니 계층은 사용하지 말자 - 안티패턴!</p>

<ul>
  <li>하지만 필요하다면 특정 도메인만 제한적으로 사용하는 것도 좋다.</li>
</ul>

마무리

<ul>
  <li>도메인 서비스는 필요할 때 사용
    <ul>
      <li>남용하면 빈약한 도메인 모델화</li>
    </ul>
  </li>
  <li>무상태</li>
  <li>VS 애플리케이션 서비스</li>
</ul>

    <p><a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvvluAbWcG-2BU3j-2FPxQHfsN0S3uz-2Bt6VhJ35WV6suoMgZkQ-3D-3Dzter_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXu-2FouefCEgnkD7PSw4-2FTKpokxVLmkzYWDLUZoDFVKadL0jYK4DSH1Yn2VNnhcTQEft7ak6193QuE3SDitDT5Dwj4RxJgsOyqXkTo8S9UvQxF76dcQojevjGWhbpfgaC5SGMqxD7Ihu0ML4YD7OJ15wsqYmQYnYu2nj4yeM87jMaAssGa0k0C-2BuOlhQHORXH-2BVXmXA7mw5Uu77VLCIg4l3vw">IDDD 7장. 서비스</a> was originally published by MJ at <a href="https://u2109659.ct.sendgrid.net/ls/click?upn=ZAq1pAP0VzkeAz11YnKryt4BYFVDBFhXcTsI2IcTQvvsNBNYnRXmInA7E20V1hcUXBmc_36V6FUE0kTxFnhSWw7o3GQWEe8aLnTkfbNhUO297vXu-2FouefCEgnkD7PSw4-2FTKpokxVLmkzYWDLUZoDFVKadL59XgR5FNMBxB4ccZ2j0nBzEx-2F-2Bf5MBfQLJzxBCtn-2B8iLjtnJRVxETreWp1NW5fmgpeeYt3KsKB0GklCRNrB3yk2gN3TSWcvlRh7b2IJI1IFtDMEXxte57qIrLyTtTtX5I2kPYmDXW7RDKcw5ER-2BO5841NL5dumDNGsspsiV8XnI">DevOOOOOOOOP</a> on May 18, 2018.</p>
  
  <img src="https://u2109659.ct.sendgrid.net/wf/open?upn=cJLOC9d7r8t51HUVjv2NkHnAh-2BqQdgMVWdxi0cfrbMOFOQvjQs-2BQKxQWqAf0URUTTjz5r2Gpm8oEWLexbdkJGiB-2BXmwoNJogZ0s2hu6wtA04YUsMLBZAyURf04MuxLWs6fDqboONdJ7cE1oksEPTtFBp8yhAyKQGtD3URPjyS99i-2Bg7paj-2BkOWdEP6jrbpgm0ax94QrohuZDtYYj6ZZUzam2inZ4PJwKThQGoIZozHC4MTSZG0PMiag9zLiOmLc4" alt="" width="1" height="1" />

  
</div>

/imyaman/2020/05/003899.html

  </body>
</html>
